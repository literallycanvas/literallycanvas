!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.LC=t()}}(function(){return function t(e,n,i){function o(s,a){if(!n[s]){if(!e[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+s+"'")}var l=n[s]={exports:{}};e[s][0].call(l.exports,function(t){var n=e[s][1][t];return o(n?n:t)},l,l.exports,t,e,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(t,e,n){},{}],2:[function(t,e,n){var i,o,r,s,a,h,l,c,u,p,d,f,g,m,y,S=function(t,e){return function(){return t.apply(e,arguments)}},v=[].slice,x=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};a=t("./actions"),h=t("./bindEvents"),c=t("./math"),y=t("./shapes"),l=y.createShape,g=y.shapeToJSON,o=y.JSONToShape,u=t("./canvasRenderer").renderShapeToContext,p=t("./svgRenderer").renderShapeToSVG,d=t("./renderSnapshotToImage"),f=t("./renderSnapshotToSVG"),s=t("../tools/Pencil"),m=t("./util"),i="infinite",e.exports=r=function(){function t(t,e){this.containerEl=t,this.setImageSize=S(this.setImageSize,this),this._unsubscribeEvents=h(this,this.containerEl,e.keyboardShortcuts),this.opts=e,this.config={zoomMin:e.zoomMin||.2,zoomMax:e.zoomMax||4,zoomStep:e.zoomStep||.2},this.colors={primary:e.primaryColor||"#000",secondary:e.secondaryColor||"#fff",background:e.backgroundColor||"transparent"},this.containerEl.style["background-color"]=this.colors.background,this.watermarkImage=e.watermarkImage,this.watermarkScale=e.watermarkScale||1,this.backgroundCanvas=document.createElement("canvas"),this.backgroundCtx=this.backgroundCanvas.getContext("2d"),this.containerEl.appendChild(this.backgroundCanvas),this.backgroundShapes=e.backgroundShapes||[],this._shapesInProgress=[],this.canvas=document.createElement("canvas"),this.canvas.style["background-color"]="transparent",this.containerEl.appendChild(this.canvas),this.buffer=document.createElement("canvas"),this.buffer.style["background-color"]="transparent",this.ctx=this.canvas.getContext("2d"),this.bufferCtx=this.buffer.getContext("2d"),this.backingScale=m.getBackingScale(this.ctx),this.shapes=[],this.undoStack=[],this.redoStack=[],this.isDragging=!1,this.position={x:0,y:0},this.scale=1,this.tool=new this.opts.tools[0](this),this.width=e.imageSize.width||i,this.height=e.imageSize.height||i,this.setZoom(this.scale),m.matchElementSize(this.containerEl,[this.backgroundCanvas,this.canvas],this.backingScale,function(t){return function(){return t.keepPanInImageBounds(),t.repaintAllLayers()}}(this)),this.watermarkImage&&(this.watermarkImage.onload=function(t){return function(){return t.repaintLayer("background")}}(this)),e.snapshot&&this.loadSnapshot(e.snapshot)}return t.prototype._teardown=function(){return this.tool.willBecomeInactive(this),this.tool=null,this._unsubscribeEvents()},t.prototype.trigger=function(t,e){return this.canvas.dispatchEvent(new CustomEvent(t,{detail:e})),null},t.prototype.on=function(t,e){var n;return n=function(t){return e(t.detail)},this.canvas.addEventListener(t,n),function(e){return function(){return e.canvas.removeEventListener(t,n)}}(this)},t.prototype.getRenderScale=function(){return this.scale*this.backingScale},t.prototype.clientCoordsToDrawingCoords=function(t,e){return{x:(t*this.backingScale-this.position.x)/this.getRenderScale(),y:(e*this.backingScale-this.position.y)/this.getRenderScale()}},t.prototype.drawingCoordsToClientCoords=function(t,e){return{x:t*this.getRenderScale()+this.position.x,y:e*this.getRenderScale()+this.position.y}},t.prototype.setImageSize=function(t,e){return this.width=t||i,this.height=e||i,this.keepPanInImageBounds(),this.repaintAllLayers(),this.trigger("imageSizeChange",{width:this.width,height:this.height})},t.prototype.setTool=function(t){return this.tool.willBecomeInactive(this),this.tool=t,this.trigger("toolChange",{tool:t}),t.didBecomeActive(this)},t.prototype.setShapesInProgress=function(t){return this._shapesInProgress=t},t.prototype.pointerDown=function(t,e){var n;return n=this.clientCoordsToDrawingCoords(t,e),this.tool.usesSimpleAPI?(this.tool.begin(n.x,n.y,this),this.isDragging=!0,this.trigger("drawStart",{tool:this.tool})):(this.isDragging=!0,this.trigger("lc-pointerdown",{tool:this.tool,x:n.x,y:n.y,rawX:t,rawY:e}))},t.prototype.pointerMove=function(t,e){return m.requestAnimationFrame(function(n){return function(){var i;return i=n.clientCoordsToDrawingCoords(t,e),n.tool.usesSimpleAPI?n.isDragging?(n.tool["continue"](i.x,i.y,n),n.trigger("drawContinue",{tool:n.tool})):void 0:n.isDragging?n.trigger("lc-pointerdrag",{tool:n.tool,x:i.x,y:i.y,rawX:t,rawY:e}):n.trigger("lc-pointermove",{tool:n.tool,x:i.x,y:i.y,rawX:t,rawY:e})}}(this))},t.prototype.pointerUp=function(t,e){var n;return n=this.clientCoordsToDrawingCoords(t,e),this.tool.usesSimpleAPI?this.isDragging?(this.tool.end(n.x,n.y,this),this.isDragging=!1,this.trigger("drawEnd",{tool:this.tool})):void 0:(this.isDragging=!1,this.trigger("lc-pointerup",{tool:this.tool,x:n.x,y:n.y,rawX:t,rawY:e}))},t.prototype.setColor=function(t,e){switch(this.colors[t]=e,t){case"background":this.containerEl.style.backgroundColor=this.colors.background,this.repaintLayer("background");break;case"primary":this.repaintLayer("main");break;case"secondary":this.repaintLayer("main")}return this.trigger(""+t+"ColorChange",this.colors[t]),"background"===t?this.trigger("drawingChange"):void 0},t.prototype.getColor=function(t){return this.colors[t]},t.prototype.saveShape=function(t,e,n){return null==e&&(e=!0),null==n&&(n=null),n||(n=this.shapes.length?this.shapes[this.shapes.length-1].id:null),this.execute(new a.AddShapeAction(this,t,n)),e&&this.trigger("shapeSave",{shape:t,previousShapeId:n}),this.trigger("drawingChange")},t.prototype.pan=function(t,e){return this.setPan(this.position.x-t,this.position.y-e)},t.prototype.keepPanInImageBounds=function(){var t,e,n,o;return t=this.getRenderScale(),o=this.position,e=o.x,n=o.y,this.width!==i&&(e=this.canvas.width>this.width*t?(this.canvas.width-this.width*t)/2:Math.max(Math.min(0,e),this.canvas.width-this.width*t)),this.height!==i&&(n=this.canvas.height>this.height*t?(this.canvas.height-this.height*t)/2:Math.max(Math.min(0,n),this.canvas.height-this.height*t)),this.position={x:e,y:n}},t.prototype.setPan=function(t,e){return this.position={x:t,y:e},this.keepPanInImageBounds(),this.repaintAllLayers(),this.trigger("pan",{x:this.position.x,y:this.position.y})},t.prototype.zoom=function(t){var e;return e=this.scale+t,e=Math.max(e,this.config.zoomMin),e=Math.min(e,this.config.zoomMax),e=Math.round(100*e)/100,this.setZoom(e)},t.prototype.setZoom=function(t){var e;return e=this.scale,this.scale=t,this.position.x=c.scalePositionScalar(this.position.x,this.canvas.width,e,this.scale),this.position.y=c.scalePositionScalar(this.position.y,this.canvas.height,e,this.scale),this.keepPanInImageBounds(),this.repaintAllLayers(),this.trigger("zoom",{oldScale:e,newScale:this.scale})},t.prototype.repaintAllLayers=function(){var t,e,n,i;for(i=["background","main"],e=0,n=i.length;n>e;e++)t=i[e],this.repaintLayer(t);return null},t.prototype.repaintLayer=function(t,e){var n;switch(null==e&&(e="main"===t),t){case"background":this.backgroundCtx.clearRect(0,0,this.backgroundCanvas.width,this.backgroundCanvas.height),n=function(t){return function(){return t.repaintLayer("background")}}(this),this.watermarkImage&&this._renderWatermark(this.backgroundCtx,!0,n),this.draw(this.backgroundShapes,this.backgroundCtx,n);break;case"main":n=function(t){return function(){return t.repaintLayer("main",!0)}}(this),e&&(this.buffer.width=this.canvas.width,this.buffer.height=this.canvas.height,this.bufferCtx.clearRect(0,0,this.buffer.width,this.buffer.height),this.draw(this.shapes,this.bufferCtx,n)),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.width>0&&this.canvas.height>0&&(this.ctx.fillStyle="#ccc",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.clipped(function(t){return function(){return t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height),t.ctx.drawImage(t.buffer,0,0)}}(this),this.ctx),this.clipped(function(t){return function(){return t.transformed(function(){var e,n,i,o,r;for(o=t._shapesInProgress,r=[],n=0,i=o.length;i>n;n++)e=o[n],r.push(u(t.ctx,e,{bufferCtx:t.bufferCtx,shouldOnlyDrawLatest:!0}));return r},t.ctx,t.bufferCtx)}}(this),this.ctx,this.bufferCtx))}return this.trigger("repaint",{layerKey:t})},t.prototype._renderWatermark=function(t,e,n){return null==e&&(e=!0),this.watermarkImage.width?(t.save(),t.translate(t.canvas.width/2,t.canvas.height/2),t.scale(this.watermarkScale,this.watermarkScale),e&&t.scale(this.backingScale,this.backingScale),t.drawImage(this.watermarkImage,-this.watermarkImage.width/2,-this.watermarkImage.height/2),t.restore()):void(this.watermarkImage.onload=n)},t.prototype.drawShapeInProgress=function(t){return this.repaintLayer("main",!1),this.clipped(function(e){return function(){return e.transformed(function(){return u(e.ctx,t,{bufferCtx:e.bufferCtx,shouldOnlyDrawLatest:!0})},e.ctx,e.bufferCtx)}}(this),this.ctx,this.bufferCtx)},t.prototype.draw=function(t,e,n){var i;if(t.length)return i=function(i){return function(){var i,o,r,s;for(s=[],o=0,r=t.length;r>o;o++)i=t[o],s.push(u(e,i,{retryCallback:n}));return s}}(this),this.clipped(function(t){return function(){return t.transformed(i,e)}}(this),e)},t.prototype.clipped=function(){var t,e,n,o,r,s,a,h,l,c,u,p;for(n=arguments[0],t=2<=arguments.length?v.call(arguments,1):[],s=this.width===i?0:this.position.x,a=this.height===i?0:this.position.y,r=function(){switch(this.width){case i:return this.canvas.width;default:return this.width*this.getRenderScale()}}.call(this),o=function(){switch(this.height){case i:return this.canvas.height;default:return this.height*this.getRenderScale()}}.call(this),h=0,c=t.length;c>h;h++)e=t[h],e.save(),e.beginPath(),e.rect(s,a,r,o),e.clip();for(n(),p=[],l=0,u=t.length;u>l;l++)e=t[l],p.push(e.restore());return p},t.prototype.transformed=function(){var t,e,n,i,o,r,s,a,h;for(n=arguments[0],t=2<=arguments.length?v.call(arguments,1):[],o=0,s=t.length;s>o;o++)e=t[o],e.save(),e.translate(Math.floor(this.position.x),Math.floor(this.position.y)),i=this.getRenderScale(),e.scale(i,i);for(n(),h=[],r=0,a=t.length;a>r;r++)e=t[r],h.push(e.restore());return h},t.prototype.clear=function(){var t,e;return e=this.shapes,t=[],this.execute(new a.ClearAction(this,e,t)),this.repaintLayer("main"),this.trigger("clear",null),this.trigger("drawingChange",{})},t.prototype.execute=function(t){return this.undoStack.push(t),t["do"](),this.redoStack=[]},t.prototype.undo=function(){var t;if(this.undoStack.length)return t=this.undoStack.pop(),t.undo(),this.redoStack.push(t),this.trigger("undo",{action:t}),this.trigger("drawingChange",{})},t.prototype.redo=function(){var t;if(this.redoStack.length)return t=this.redoStack.pop(),this.undoStack.push(t),t["do"](),this.trigger("redo",{action:t}),this.trigger("drawingChange",{})},t.prototype.canUndo=function(){return!!this.undoStack.length},t.prototype.canRedo=function(){return!!this.redoStack.length},t.prototype.getPixel=function(t,e){var n,i;return n=this.drawingCoordsToClientCoords(t,e),i=this.ctx.getImageData(n.x,n.y,1,1).data,i[3]?"rgb("+i[0]+", "+i[1]+", "+i[2]+")":null},t.prototype.getContentBounds=function(){return m.getBoundingRect(this.shapes.concat(this.backgroundShapes).map(function(t){return t.getBoundingRect()}),this.width===i?0:this.width,this.height===i?0:this.height)},t.prototype.getImage=function(t){return null==t&&(t={}),null==t.includeWatermark&&(t.includeWatermark=!0),null==t.scaleDownRetina&&(t.scaleDownRetina=!0),null==t.scale&&(t.scale=1),t.scaleDownRetina||(t.scale*=this.backingScale),t.includeWatermark&&(t.watermarkImage=this.watermarkImage,t.watermarkScale=this.watermarkScale,t.scaleDownRetina||(t.watermarkScale*=this.backingScale)),d(this.getSnapshot(),t)},t.prototype.canvasForExport=function(){return this.repaintAllLayers(),m.combineCanvases(this.backgroundCanvas,this.canvas)},t.prototype.canvasWithBackground=function(t){return m.combineCanvases(t,this.canvasForExport())},t.prototype.getSnapshot=function(t){var e,n,i,o,r,s;for(null==t&&(t=null),null==t&&(t=["shapes","imageSize","colors","position","scale","backgroundShapes"]),i={},s=["colors","position","scale"],o=0,r=s.length;r>o;o++)e=s[o],x.call(t,e)>=0&&(i[e]=this[e]);return x.call(t,"shapes")>=0&&(i.shapes=function(){var t,e,i,o;for(i=this.shapes,o=[],t=0,e=i.length;e>t;t++)n=i[t],o.push(g(n));return o}.call(this)),x.call(t,"backgroundShapes")>=0&&(i.backgroundShapes=function(){var t,e,i,o;for(i=this.backgroundShapes,o=[],t=0,e=i.length;e>t;t++)n=i[t],o.push(g(n));return o}.call(this)),x.call(t,"imageSize")>=0&&(i.imageSize={width:this.width,height:this.height}),i},t.prototype.getSnapshotJSON=function(){return console.warn("lc.getSnapshotJSON() is deprecated. use JSON.stringify(lc.getSnapshot()) instead."),JSON.stringify(this.getSnapshot())},t.prototype.getSVGString=function(t){return null==t&&(t={}),f(this.getSnapshot(),t)},t.prototype.loadSnapshot=function(t){var e,n,i,r,s,h,l,c,u,p;if(t){if(t.colors)for(u=["primary","secondary","background"],s=0,l=u.length;l>s;s++)e=u[s],this.setColor(e,t.colors[e]);if(t.shapes)for(this.shapes=[],p=t.shapes,h=0,c=p.length;c>h;h++)r=p[h],i=o(r),i&&this.execute(new a.AddShapeAction(this,i));return t.backgroundShapes&&(this.backgroundShapes=function(){var e,i,r,s;for(r=t.backgroundShapes,s=[],e=0,i=r.length;i>e;e++)n=r[e],s.push(o(n));return s}()),t.imageSize&&(this.width=t.imageSize.width,this.height=t.imageSize.height),t.position&&(this.position=t.position),t.scale&&(this.scale=t.scale),this.repaintAllLayers(),this.trigger("snapshotLoad"),this.trigger("drawingChange",{})}},t.prototype.loadSnapshotJSON=function(t){return console.warn("lc.loadSnapshotJSON() is deprecated. use lc.loadSnapshot(JSON.parse(snapshot)) instead."),this.loadSnapshot(JSON.parse(t))},t}()},{"../tools/Pencil":40,"./actions":4,"./bindEvents":5,"./canvasRenderer":6,"./math":10,"./renderSnapshotToImage":11,"./renderSnapshotToSVG":12,"./shapes":13,"./svgRenderer":14,"./util":15}],3:[function(t,e,n){var i,o,r,s;t("./fontmetrics.js"),s=function(t){var e,n,i,o,r,s,a,h;for(n=t.split(" "),i=0,a=0,h=n.length;h>a;a++)o=n[a],r=parseInt(o.replace("px",""),10),isNaN(r)||(i=r);if(!i)throw"Font size not found";return s=t.substring(n[0].length+1).replace("bold ","").replace("italic ","").replace("underline ",""),e=s,{fontSize:i,fontFamily:e}},r=function(t,e,n){var i,o,r,s,a,h,l,c,u,p;if(!e.length)return["",""];for(o=0,h=0,l=0,p=!1;;)if(o+=1,r=o>=e.length,a=!r&&e[o].match(/\s/),s=a||r,u=e.substring(0,o),i=n?t.measureTextWidth(u).width<=n:!0,i&&(l=o),s&&p&&(p=!1,i&&(h=o)),p=!a,r||!i){if(i)return[e,""];if(h>0){for(c=h+1;c<e.length&&e[c].match("/s/");)c+=1;return[e.substring(0,h),e.substring(c)]}return[e.substring(0,l),e.substring(l)]}},o=function(t,e,n){var i,o,s,a,h,l,c,u,p;for(h=e.split(/\r\n|\r|\n/g),i=[],l=0,c=h.length;c>l;l++)if(a=h[l],u=r(t,a,n),o=u[0],s=u[1],o)for(;o;)i.push(o),p=r(t,s,n),o=p[0],s=p[1];else i.push(a);return i},i=function(){function t(t,e,n,i,r){var a,h,l;this.text=e,this.font=n,this.forcedWidth=i,this.forcedHeight=r,l=s(this.font),a=l.fontFamily,h=l.fontSize,t.font=this.font,t.textBaseline="baseline",this.emDashWidth=t.measureTextWidth("â€”",h,a).width,this.caratWidth=t.measureTextWidth("|",h,a).width,this.lines=o(t,e,this.forcedWidth),this.metricses=this.lines.map(function(e){return function(n){return t.measureText2(n||"X",h,e.font)}}(this)),this.metrics={ascent:Math.max.apply(Math,this.metricses.map(function(t){var e;return e=t.ascent})),descent:Math.max.apply(Math,this.metricses.map(function(t){var e;return e=t.descent})),fontsize:Math.max.apply(Math,this.metricses.map(function(t){var e;return e=t.fontsize})),leading:Math.max.apply(Math,this.metricses.map(function(t){var e;return e=t.leading})),width:Math.max.apply(Math,this.metricses.map(function(t){var e;return e=t.width})),height:Math.max.apply(Math,this.metricses.map(function(t){var e;return e=t.height})),bounds:{minx:Math.min.apply(Math,this.metricses.map(function(t){var e;return e=t.bounds,e.minx})),miny:Math.min.apply(Math,this.metricses.map(function(t){var e;return e=t.bounds,e.miny})),maxx:Math.max.apply(Math,this.metricses.map(function(t){var e;return e=t.bounds,e.maxx})),maxy:Math.max.apply(Math,this.metricses.map(function(t){var e;return e=t.bounds,e.maxy}))}},this.boundingBoxWidth=Math.ceil(this.metrics.width)}return t.prototype.draw=function(t,e,n){var i,o,r,s,a,h;for(t.textBaseline="top",t.font=this.font,i=0,a=this.lines,h=[],r=0,s=a.length;s>r;r++)o=a[r],t.fillText(o,e,n+i*this.metrics.leading),h.push(i+=1);return h},t.prototype.getWidth=function(t){return null==t&&(t=!1),this.forcedWidth?this.forcedWidth:t?this.metrics.bounds.maxx+this.caratWidth:this.metrics.bounds.maxx},t.prototype.getHeight=function(){return this.forcedHeight||this.metrics.leading*this.lines.length},t}(),e.exports=i},{"./fontmetrics.js":7}],4:[function(t,e,n){var i,o;o=function(){function t(t,e,n){this.lc=t,this.oldShapes=e,this.newShapes=n}return t.prototype["do"]=function(){return this.lc.shapes=this.newShapes,this.lc.repaintLayer("main")},t.prototype.undo=function(){return this.lc.shapes=this.oldShapes,this.lc.repaintLayer("main")},t}(),i=function(){function t(t,e,n){this.lc=t,this.shape=e,this.previousShapeId=null!=n?n:null}return t.prototype["do"]=function(){var t,e,n,i,o,r;if(this.lc.shapes.length&&this.lc.shapes[this.lc.shapes.length-1].id!==this.previousShapeId&&null!==this.previousShapeId){for(e=[],t=!1,r=this.lc.shapes,i=0,o=r.length;o>i;i++)n=r[i],e.push(n),n.id===this.previousShapeId&&(e.push(this.shape),t=!0);t||e.push(this.shape),this.lc.shapes=e}else this.lc.shapes.push(this.shape);return this.lc.repaintLayer("main")},t.prototype.undo=function(){var t,e,n,i,o;if(this.lc.shapes[this.lc.shapes.length-1].id===this.shape.id)this.lc.shapes.pop();else{for(t=[],o=this.lc.shapes,n=0,i=o.length;i>n;n++)e=o[n],e.id!==this.shape.id&&t.push(e);lc.shapes=t}return this.lc.repaintLayer("main")},t}(),e.exports={ClearAction:o,AddShapeAction:i}},{}],5:[function(t,e,n){var i,o,r,s;r=function(t,e){var n,i,o;return i=e.changedTouches[0].clientX,o=e.changedTouches[0].clientY,n=t.getBoundingClientRect(),[i-n.left,o-n.top]},s=function(t,e){var n;return n=t.getBoundingClientRect(),{left:e.clientX-n.left,top:e.clientY-n.top}},o=function(t){return null!=t.buttons?1===t.buttons:t.which>0},e.exports=i=function(t,e,n){var i,o,a,h,l,c;return null==n&&(n=!1),c=[],o=function(n){return function(n){var i;return n.preventDefault(),i=s(e,n),t.pointerMove(i.left,i.top)}}(this),a=function(n){return function(n){var i;return n.preventDefault(),e.onselectstart=function(){return!0},i=s(e,n),t.pointerUp(i.left,i.top),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",a),e.addEventListener("mousemove",o)}}(this),e.addEventListener("mousedown",function(n){return function(n){var i,r;if("canvas"===n.target.tagName.toLowerCase())return i=!0,n.preventDefault(),e.onselectstart=function(){return!1},r=s(e,n),t.pointerDown(r.left,r.top),e.removeEventListener("mousemove",o),document.addEventListener("mousemove",o),document.addEventListener("mouseup",a)}}(this)),l=function(n){return n.preventDefault(),t.pointerMove.apply(t,r(e,n))},h=function(n){return n.preventDefault(),t.pointerUp.apply(t,r(e,n)),document.removeEventListener("touchmove",l),document.removeEventListener("touchend",h),document.removeEventListener("touchcancel",h)},e.addEventListener("touchstart",function(n){return"canvas"===n.target.tagName.toLowerCase()?(n.preventDefault(),1===n.touches.length?(t.pointerDown.apply(t,r(e,n)),document.addEventListener("touchmove",l),document.addEventListener("touchend",h),document.addEventListener("touchcancel",h)):t.pointerMove.apply(t,r(e,n))):void 0}),n&&(console.warn("Keyboard panning is deprecated."),i=function(e){switch(e.keyCode){case 37:t.pan(-10,0);break;case 38:t.pan(0,-10);break;case 39:t.pan(10,0);break;case 40:t.pan(0,10)}return t.repaintAllLayers()},document.addEventListener("keydown",i),c.push(function(){return document.removeEventListener(i)})),function(){var t,e,n,i;for(i=[],e=0,n=c.length;n>e;e++)t=c[e],i.push(t());return i}}},{}],6:[function(t,e,n){var i,o,r,s,a,h,l,c,u,p,d;h=t("./lineEndCapShapes.coffee"),p={},i=function(t,e,n){return p[t]={drawFunc:e,drawLatestFunc:n}},l=function(){},u=function(t,e,n){var i;if(null==n&&(n={}),null==n.shouldIgnoreUnsupportedShapes&&(n.shouldIgnoreUnsupportedShapes=!1),null==n.retryCallback&&(n.retryCallback=l),null==n.shouldOnlyDrawLatest&&(n.shouldOnlyDrawLatest=!1),null==n.bufferCtx&&(n.bufferCtx=null),i=n.bufferCtx,p[e.className])return n.shouldOnlyDrawLatest&&p[e.className].drawLatestFunc?p[e.className].drawLatestFunc(t,i,e,n.retryCallback):p[e.className].drawFunc(t,e,n.retryCallback);if(n.shouldIgnoreUnsupportedShapes)return console.warn("Can't render shape of type "+e.className+" to canvas");throw"Can't render shape of type "+e.className+" to canvas"},c=function(t,e,n){return u(t.getContext("2d"),e,n)},i("Rectangle",function(t,e){var n,i;return n=e.x,i=e.y,e.strokeWidth%2!==0&&(n+=.5,i+=.5),t.fillStyle=e.fillColor,t.fillRect(n,i,e.width,e.height),t.lineWidth=e.strokeWidth,t.strokeStyle=e.strokeColor,t.strokeRect(n,i,e.width,e.height)}),i("Ellipse",function(t,e){var n,i,o,r;return t.save(),r=Math.floor(e.width/2),o=Math.floor(e.height/2),n=e.x+r,i=e.y+o,t.translate(n,i),t.scale(1,Math.abs(e.height/e.width)),t.beginPath(),t.arc(0,0,Math.abs(r),0,2*Math.PI),t.closePath(),t.restore(),t.fillStyle=e.fillColor,t.fill(),t.lineWidth=e.strokeWidth,t.strokeStyle=e.strokeColor,t.stroke()}),i("SelectionBox",function(){var t;return t=function(t,e,n,i){var o,r;return o=n.x,r=n.y,t.fillStyle="#fff",t.fillRect(o,r,i,i),t.strokeStyle="#000",t.strokeRect(o,r,i,i)},function(e,n){return n.backgroundColor&&(e.fillStyle=n.backgroundColor,e.fillRect(n._br.x-n.margin,n._br.y-n.margin,n._br.width+2*n.margin,n._br.height+2*n.margin)),e.lineWidth=1,e.strokeStyle="#000",e.setLineDash([2,4]),e.strokeRect(n._br.x-n.margin,n._br.y-n.margin,n._br.width+2*n.margin,n._br.height+2*n.margin),e.setLineDash([]),t(e,n.getTopLeftHandleRect(),n.handleSize),t(e,n.getTopRightHandleRect(),n.handleSize),t(e,n.getBottomLeftHandleRect(),n.handleSize),t(e,n.getBottomRightHandleRect(),n.handleSize)}}()),i("Image",function(t,e,n){var i;return e.image.width?t.drawImage(e.image,e.x,e.y):n?(i=e.image.onload,e.image.onload=function(){return"function"==typeof i&&i(),n()}):void 0}),i("Line",function(t,e){var n,i,o,r,s;if(e.x1!==e.x2||e.y1!==e.y2)return i=e.x1,o=e.x2,r=e.y1,s=e.y2,e.strokeWidth%2!==0&&(i+=.5,o+=.5,r+=.5,s+=.5),t.lineWidth=e.strokeWidth,t.strokeStyle=e.color,t.lineCap=e.capStyle,e.dash&&t.setLineDash(e.dash),t.beginPath(),t.moveTo(i,r),t.lineTo(o,s),t.stroke(),e.dash&&t.setLineDash([]),n=Math.max(2.2*e.strokeWidth,5),e.endCapShapes[0]&&h[e.endCapShapes[0]].drawToCanvas(t,i,r,Math.atan2(r-s,i-o),n,e.color),e.endCapShapes[1]?h[e.endCapShapes[1]].drawToCanvas(t,o,s,Math.atan2(s-r,o-i),n,e.color):void 0}),d=function(t,e,n,i){var o,r,s,a;if(null==n&&(n=!1),null==i&&(i="round"),e.length){for(t.lineCap=i,t.strokeStyle=e[0].color,t.lineWidth=e[0].size,t.beginPath(),e[0].size%2===0?t.moveTo(e[0].x,e[0].y):t.moveTo(e[0].x+.5,e[0].y+.5),a=e.slice(1),r=0,s=a.length;s>r;r++)o=a[r],e[0].size%2===0?t.lineTo(o.x,o.y):t.lineTo(o.x+.5,o.y+.5);return n?t.closePath():void 0}},s=function(t,e){return d(t,e.smoothedPoints),t.stroke()},a=function(t,e,n){var i,o,r;return n.tail?(r=n.smoothedPoints.length-n.segmentSize*n.tailSize,o=r<2*n.segmentSize?0:r,i=r+n.segmentSize+1,d(e,n.smoothedPoints.slice(o,i)),e.stroke()):(d(e,n.smoothedPoints),e.stroke())},i("LinePath",s,a),o=function(t,e){return t.save(),t.globalCompositeOperation="destination-out",s(t,e),t.restore()},r=function(t,e,n){return t.save(),t.globalCompositeOperation="destination-out",e.save(),e.globalCompositeOperation="destination-out",a(t,e,n),t.restore(),e.restore()},i("ErasedLinePath",o,r),i("Text",function(t,e){return e.renderer||e._makeRenderer(t),t.fillStyle=e.color,e.renderer.draw(t,e.x,e.y)}),i("Polygon",function(t,e){return t.fillStyle=e.fillColor,d(t,e.points,e.isClosed,"butt"),t.fill(),t.stroke()}),e.exports={defineCanvasRenderer:i,renderShapeToCanvas:c,renderShapeToContext:u}},{"./lineEndCapShapes.coffee":8}],7:[function(t,e,n){!function(){if(!document.defaultView.getComputedStyle)throw"ERROR: 'document.defaultView.getComputedStyle' not found. This library only works in browsers that can report computed CSS values.";CanvasRenderingContext2D.prototype.measureTextWidth=CanvasRenderingContext2D.prototype.measureText;var t=function(t,e){return document.defaultView.getComputedStyle(t,null).getPropertyValue(e)};CanvasRenderingContext2D.prototype.measureText2=function(e,n,i){var o=this.measureTextWidth(e),r=!/\S/.test(e);o.fontsize=n;var s=document.createElement("div");s.style.position="absolute",s.style.opacity=0,s.style.font=i,s.innerHTML=e+"<br/>"+e,document.body.appendChild(s),o.leading=1.2*n;var a=t(s,"height");if(a=a.replace("px",""),a>=2*n&&(o.leading=a/2|0),document.body.removeChild(s),r)o.ascent=0,o.descent=0,o.bounds={minx:0,maxx:o.width,miny:0,maxy:0},o.height=0;else{var h=document.createElement("canvas"),l=100;h.width=o.width+l,h.height=3*n,h.style.opacity=1,h.style.font=i;var c=h.getContext("2d");c.font=i;var u=h.width,p=h.height,d=p/2;c.fillStyle="white",c.fillRect(-1,-1,u+2,p+2),c.fillStyle="black",c.fillText(e,l/2,d);for(var f=c.getImageData(0,0,u,p).data,g=0,m=4*u,y=f.length;++g<y&&255===f[g];);var S=g/m|0;for(g=y-1;--g>0&&255===f[g];);var v=g/m|0;for(g=0;y>g&&255===f[g];)g+=m,g>=y&&(g=g-y+4);var x=g%m/4|0,w=1;for(g=y-3;g>=0&&255===f[g];)g-=m,0>g&&(g=y-3-4*w++);var b=g%m/4+1|0;o.ascent=d-S,o.descent=v-d,o.bounds={minx:x-l/2,maxx:b-l/2,miny:0,maxy:v-S},o.height=1+(v-S)}return o}}()},{}],8:[function(t,e,n){e.exports={arrow:function(){var t;return t=function(t,e,n,i,o){return[{x:t+Math.cos(n+Math.PI/2)*i/2,y:e+Math.sin(n+Math.PI/2)*i/2},{x:t+Math.cos(n)*o,y:e+Math.sin(n)*o},{x:t+Math.cos(n-Math.PI/2)*i/2,y:e+Math.sin(n-Math.PI/2)*i/2}]},{drawToCanvas:function(e,n,i,o,r,s,a){var h;return null==a&&(a=0),a=a||r,e.fillStyle=s,e.lineWidth=0,e.strokeStyle="transparent",e.beginPath(),h=t(n,i,o,r,a),e.moveTo(h[0].x,h[0].y),e.lineTo(h[1].x,h[1].y),e.lineTo(h[2].x,h[2].y),e.fill()},svg:function(e,n,i,o,r,s){var a;return null==s&&(s=0),s=s||o,a=t(e,n,i,o,s),"<polygon fill='"+r+"' stroke='none' points='"+a.map(function(t){return""+t.x+","+t.y})+"' />"}}}()}},{}],9:[function(t,e,n){var i,o,r;o={},i=function(t){return o=t},r=function(t){var e;return e=o[t],e||t},e.exports={localize:i,_:r}},{}],10:[function(t,e,n){var i,o,r,s,a,h;i=t("./shapes").Point,a=t("./util"),o={},o.toPoly=function(t){var e,n,i,o,s,a,l;for(o=[],s=[],e=0,a=0,l=t.length;l>a;a++)i=t[a],n=r(i,h(t,e)),o=o.concat([n[0]]),s=[n[1]].concat(s),e+=1;return o.concat(s)},h=function(t,e){var n;return t.length<3&&(n={x:0,y:0}),n=0===e?h(t,e+1):e===t.length-1?h(t,e-1):o.diff(t[e-1],t[e+1])},o.diff=function(t,e){return{x:e.x-t.x,y:e.y-t.y}},s=function(t){var e;return e=o.len(t),{x:t.x/e,y:t.y/e}},r=function(t,e){return e=s(e),e.x=e.x*t.size/2,e.y=e.y*t.size/2,[{x:t.x-e.y,y:t.y+e.x,color:t.color},{x:t.x+e.y,y:t.y-e.x,color:t.color}]},o.len=function(t){return Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2))},o.scalePositionScalar=function(t,e,n,i){var o,r;return r=e*n,o=e*i,t+(r-o)/2},e.exports=o},{"./shapes":13,"./util":15}],11:[function(t,e,n){var i,o,r,s;s=t("./util"),o=t("./shapes").JSONToShape,i="infinite",r=function(t,e,n){return e.width?(t.save(),t.translate(t.canvas.width/2,t.canvas.height/2),t.scale(n,n),t.drawImage(e,-e.width/2,-e.height/2),t.restore()):void 0},e.exports=function(t,e){var n,a,h,l,c,u,p,d,f,g;return null==e&&(e={}),null==e.scale&&(e.scale=1),p=function(){var e,n,i,r;for(i=t.shapes,r=[],e=0,n=i.length;n>e;e++)u=i[e],r.push(o(u));return r}(),a=[],t.backgroundShapes&&(a=function(){var e,n,i,r;for(i=t.backgroundShapes,r=[],e=0,n=i.length;n>e;e++)u=i[e],r.push(o(u));return r}()),c=t.imageSize||{width:i,height:i},g=c.width,l=c.height,h=t.colors||{background:"transparent"},n=p.concat(a),d=document.createElement("canvas"),f=d.getContext("2d"),null==e.margin&&(e.margin={top:0,right:0,bottom:0,left:0}),e.rect||(e.rect=s.getBoundingRect(function(){var t,e,i;for(i=[],t=0,e=n.length;e>t;t++)u=n[t],i.push(u.getBoundingRect(f));return i}(),g===i?0:g,l===i?0:l)),e.rect.x-=e.margin.left,e.rect.y-=e.margin.top,e.rect.width+=e.margin.left+e.margin.right,e.rect.height+=e.margin.top+e.margin.bottom,d.width=e.rect.width*e.scale,d.height=e.rect.height*e.scale,f.fillStyle=h.background,f.fillRect(0,0,d.width,d.height),e.rect.width&&e.rect.height?(e.watermarkImage&&r(f,e.watermarkImage,e.watermarkScale),s.combineCanvases(d,s.renderShapes(a,e.rect,e.scale),s.renderShapes(p,e.rect,e.scale))):null}},{"./shapes":13,"./util":15}],12:[function(t,e,n){var i,o,r;r=t("./util"),o=t("./shapes").JSONToShape,i="infinite",e.exports=function(t,e){var n,s,a,h,l,c,u,p,d,f;return null==e&&(e={}),d=function(){var e,n,i,r;for(i=t.shapes,r=[],e=0,n=i.length;n>e;e++)p=i[e],r.push(o(p));return r}(),s=[],t.backgroundShapes&&(s=function(){var e,n,i,r;for(i=t.backgroundShapes,r=[],e=0,n=i.length;n>e;e++)p=i[e],r.push(o(p));return r}()),u=t.imageSize||{width:i,height:i},f=u.width,c=u.height,a=t.colors||{background:"transparent"},n=d.concat(s),l=document.createElement("canvas"),h=l.getContext("2d"),null==e.margin&&(e.margin={top:0,right:0,bottom:0,left:0}),e.rect||(e.rect=r.getBoundingRect(function(){var t,e,i;for(i=[],t=0,e=n.length;e>t;t++)p=n[t],i.push(p.getBoundingRect(h));return i}(),f===i?0:f,c===i?0:c)),e.rect.x-=e.margin.left,e.rect.y-=e.margin.top,e.rect.width+=e.margin.left+e.margin.right,e.rect.height+=e.margin.top+e.margin.bottom,LC.renderShapesToSVG(s.concat(d),e.rect,a.background)}},{"./shapes":13,"./util":15}],13:[function(t,e,n){var i,o,r,s,a,h,l,c,u,p,d,f,g,m,y,S,v,x,w,b,k,C;y=t("./util"),r=t("./TextRenderer"),u=t("./lineEndCapShapes.coffee"),b=t("./canvasRenderer"),h=b.defineCanvasRenderer,d=b.renderShapeToContext,k=t("./svgRenderer"),l=k.defineSVGRenderer,f=k.renderShapeToSVG,m={},c=function(t,e){var n,i,o,r,s,a,c,u;n=function(t,n,i,o,r,s,a,h,l,c,u,p,d,f,g,m){return e.constructor.call(this,t,n,i,o,r,s,a,h,l,c,u,p,d,f,g,m),this},n.prototype.className=t,n.fromJSON=e.fromJSON,e.draw&&(s=e.draw,a=e.draw||function(t,e,n){return this.draw(t,e,n)},i=function(t,e,n){return s.call(e,t,n)},o=function(t,e,n,i){return a.call(n,t,e,i)},delete e.draw,e.drawLatest&&delete e.drawLatest,h(t,i,o)),e.toSVG&&(c=e.toSVG,u=function(t){return c.call(t)},delete e.toSVG,l(t,u)),n.prototype.draw=function(t,e){return d(t,this,{retryCallback:e})},n.prototype.drawLatest=function(t,e,n){return d(t,this,{retryCallback:n,bufferCtx:e,shouldOnlyDrawLatest:!0})},n.prototype.toSVG=function(){return f(this)};for(r in e)"fromJSON"!==r&&(n.prototype[r]=e[r]);return m[t]=n,n},a=function(t,e,n,i,o,r,s,a,h,l,c,u,p,d,f,g,S){var v;return v=new m[t](e,n,i,o,r,s,a,h,l,c,u,p,d,f,g,S),v.id=y.getGUID(),v},i=function(t){var e,n,i,o;return e=t.className,n=t.data,i=t.id,e in m?(o=m[e].fromJSON(n),o?(i&&(o.id=i),o):(console.log("Unreadable shape:",e,n),null)):(console.log("Unknown shape:",e,n),null)},g=function(t){return{className:t.className,data:t.toJSON(),id:t.id}},s=function(t,e){return e?s(x(x(C(t))),e-1):t},C=function(t){var e,n,i,o,r;for(t=[t[0]].concat(t).concat(y.last(t)),i=[],e=0,o=0,r=t.length;r>o;o++)n=t[o],i[2*e]=n,t[e+1]&&(i[2*e+1]=w(n,t[e+1])),e+=1;return i},x=function(t){var e,n,i,o,r;for(e=[],n=0,o=0,r=t.length;r>o;o++)i=t[o],t[n+1]&&(e[n]=w(i,t[n+1])),n+=1;return e},w=function(t,e){return a("Point",{x:t.x+(e.x-t.x)/2,y:t.y+(e.y-t.y)/2,size:t.size+(e.size-t.size)/2,color:t.color})},c("Image",{constructor:function(t){return null==t&&(t={}),
this.x=t.x||0,this.y=t.y||0,this.image=t.image||null},getBoundingRect:function(){return{x:this.x,y:this.y,width:this.image.width,height:this.image.height}},toJSON:function(){return{x:this.x,y:this.y,imageSrc:this.image.src,imageObject:this.image}},fromJSON:function(t){var e,n;return e=null,(null!=(n=t.imageObject)?n.width:void 0)?e=t.imageObject:(e=new Image,e.src=t.imageSrc),a("Image",{x:t.x,y:t.y,image:e})}}),c("Rectangle",{constructor:function(t){return null==t&&(t={}),this.x=t.x||0,this.y=t.y||0,this.width=t.width||0,this.height=t.height||0,this.strokeWidth=t.strokeWidth||1,this.strokeColor=t.strokeColor||"black",this.fillColor=t.fillColor||"transparent"},getBoundingRect:function(){return{x:this.x-this.strokeWidth/2,y:this.y-this.strokeWidth/2,width:this.width+this.strokeWidth,height:this.height+this.strokeWidth}},toJSON:function(){return{x:this.x,y:this.y,width:this.width,height:this.height,strokeWidth:this.strokeWidth,strokeColor:this.strokeColor,fillColor:this.fillColor}},fromJSON:function(t){return a("Rectangle",t)}}),c("Ellipse",{constructor:function(t){return null==t&&(t={}),this.x=t.x||0,this.y=t.y||0,this.width=t.width||0,this.height=t.height||0,this.strokeWidth=t.strokeWidth||1,this.strokeColor=t.strokeColor||"black",this.fillColor=t.fillColor||"transparent"},getBoundingRect:function(){return{x:this.x-this.strokeWidth/2,y:this.y-this.strokeWidth/2,width:this.width+this.strokeWidth,height:this.height+this.strokeWidth}},toJSON:function(){return{x:this.x,y:this.y,width:this.width,height:this.height,strokeWidth:this.strokeWidth,strokeColor:this.strokeColor,fillColor:this.fillColor}},fromJSON:function(t){return a("Ellipse",t)}}),c("Line",{constructor:function(t){return null==t&&(t={}),this.x1=t.x1||0,this.y1=t.y1||0,this.x2=t.x2||0,this.y2=t.y2||0,this.strokeWidth=t.strokeWidth||1,this.color=t.color||"black",this.capStyle=t.capStyle||"round",this.endCapShapes=t.endCapShapes||[null,null],this.dash=t.dash||null},getBoundingRect:function(){return{x:Math.min(this.x1,this.x2)-this.strokeWidth/2,y:Math.min(this.y1,this.y2)-this.strokeWidth/2,width:Math.abs(this.x2-this.x1)+this.strokeWidth/2,height:Math.abs(this.y2-this.y1)+this.strokeWidth/2}},toJSON:function(){return{x1:this.x1,y1:this.y1,x2:this.x2,y2:this.y2,strokeWidth:this.strokeWidth,color:this.color,capStyle:this.capStyle,dash:this.dash,endCapShapes:this.endCapShapes}},fromJSON:function(t){return a("Line",t)}}),v=function(t){var e,n,i,o,r;if(!t.length)return!1;for(i=t[0].size,e=t[0].color,o=0,r=t.length;r>o;o++)if(n=t[o],(n.size!==i||n.color!==e)&&console.log(i,e,n.size,n.color),n.size!==i||n.color!==e)return!1;return!0},S=function(t,e){var n,o,r,s,h;return o=null,e.points?o=function(){var t,o,r,s;for(r=e.points,s=[],t=0,o=r.length;o>t;t++)n=r[t],s.push(i(n));return s}():e.pointCoordinatePairs&&(o=function(){var t,n,o,r,a;for(o=e.pointCoordinatePairs,a=[],t=0,n=o.length;n>t;t++)r=o[t],s=r[0],h=r[1],a.push(i({className:"Point",data:{x:s,y:h,size:e.pointSize,color:e.pointColor,smooth:e.smooth}}));return a}()),r=null,e.smoothedPointCoordinatePairs&&(r=function(){var t,n,o,r,a;for(o=e.smoothedPointCoordinatePairs,a=[],t=0,n=o.length;n>t;t++)r=o[t],s=r[0],h=r[1],a.push(i({className:"Point",data:{x:s,y:h,size:e.pointSize,color:e.pointColor,smooth:e.smooth}}));return a}()),o[0]?a(t,{points:o,smoothedPoints:r,order:e.order,tailSize:e.tailSize,smooth:e.smooth}):null},p={constructor:function(t){var e,n,i,o,r;if(null==t&&(t={}),n=t.points||[],this.order=t.order||3,this.tailSize=t.tailSize||3,this.smooth="smooth"in t?t.smooth:!0,this.segmentSize=Math.pow(2,this.order),this.sampleSize=this.tailSize+1,t.smoothedPoints)return this.points=t.points,this.smoothedPoints=t.smoothedPoints;for(this.points=[],r=[],i=0,o=n.length;o>i;i++)e=n[i],r.push(this.addPoint(e));return r},getBoundingRect:function(){return y.getBoundingRect(this.points.map(function(t){return{x:t.x-t.size/2,y:t.y-t.size/2,width:t.size,height:t.size}}))},toJSON:function(){var t,e;return v(this.points)?{order:this.order,tailSize:this.tailSize,smooth:this.smooth,pointCoordinatePairs:function(){var t,n,i,o;for(i=this.points,o=[],t=0,n=i.length;n>t;t++)e=i[t],o.push([e.x,e.y]);return o}.call(this),smoothedPointCoordinatePairs:function(){var t,n,i,o;for(i=this.smoothedPoints,o=[],t=0,n=i.length;n>t;t++)e=i[t],o.push([e.x,e.y]);return o}.call(this),pointSize:this.points[0].size,pointColor:this.points[0].color}:{order:this.order,tailSize:this.tailSize,smooth:this.smooth,points:function(){var e,n,i,o;for(i=this.points,o=[],e=0,n=i.length;n>e;e++)t=i[e],o.push(g(t));return o}.call(this)}},fromJSON:function(t){return S("LinePath",t)},addPoint:function(t){return this.points.push(t),this.smooth?!this.smoothedPoints||this.points.length<this.sampleSize?this.smoothedPoints=s(this.points,this.order):(this.tail=y.last(s(y.last(this.points,this.sampleSize),this.order),this.segmentSize*this.tailSize),this.smoothedPoints=this.smoothedPoints.slice(0,this.smoothedPoints.length-this.segmentSize*(this.tailSize-1)).concat(this.tail)):void(this.smoothedPoints=this.points)}},o=c("LinePath",p),c("ErasedLinePath",{constructor:p.constructor,toJSON:p.toJSON,addPoint:p.addPoint,getBoundingRect:p.getBoundingRect,fromJSON:function(t){return S("ErasedLinePath",t)}}),c("Point",{constructor:function(t){return null==t&&(t={}),this.x=t.x||0,this.y=t.y||0,this.size=t.size||0,this.color=t.color||""},getBoundingRect:function(){return{x:this.x-this.size/2,y:this.y-this.size/2,width:this.size,height:this.size}},toJSON:function(){return{x:this.x,y:this.y,size:this.size,color:this.color}},fromJSON:function(t){return a("Point",t)}}),c("Polygon",{constructor:function(t){var e,n,i,o,r;for(null==t&&(t={}),this.points=t.points,this.fillColor=t.fillColor||"white",this.strokeColor=t.strokeColor||"black",this.strokeWidth=t.strokeWidth,this.dash=t.dash||null,null==t.isClosed&&(t.isClosed=!0),this.isClosed=t.isClosed,o=this.points,r=[],n=0,i=o.length;i>n;n++)e=o[n],e.color=this.strokeColor,r.push(e.size=this.strokeWidth);return r},addPoint:function(t,e){return this.points.push(LC.createShape("Point",{x:t,y:e}))},getBoundingRect:function(){return y.getBoundingRect(this.points.map(function(t){return t.getBoundingRect()}))},toJSON:function(){return{strokeWidth:this.strokeWidth,fillColor:this.fillColor,strokeColor:this.strokeColor,dash:this.dash,isClosed:this.isClosed,pointCoordinatePairs:this.points.map(function(t){return[t.x,t.y]})}},fromJSON:function(t){return t.points=t.pointCoordinatePairs.map(function(e){var n,i;return n=e[0],i=e[1],a("Point",{x:n,y:i,size:t.strokeWidth,color:t.strokeColor})}),a("Polygon",t)}}),c("Text",{constructor:function(t){return null==t&&(t={}),this.x=t.x||0,this.y=t.y||0,this.v=t.v||0,this.text=t.text||"",this.color=t.color||"black",this.font=t.font||"18px sans-serif",this.forcedWidth=t.forcedWidth||null,this.forcedHeight=t.forcedHeight||null},_makeRenderer:function(t){return t.lineHeight=1.2,this.renderer=new r(t,this.text,this.font,this.forcedWidth,this.forcedHeight),this.v<1?(console.log("repairing baseline"),this.v=1,this.x-=this.renderer.metrics.bounds.minx,this.y-=this.renderer.metrics.leading-this.renderer.metrics.descent):void 0},setText:function(t){return this.text=t,this.renderer=null},setFont:function(t){return this.font=t,this.renderer=null},setPosition:function(t,e){return this.x=t,this.y=e},setSize:function(t,e){return this.forcedWidth=Math.max(t,0),this.forcedHeight=Math.max(e,0),this.renderer=null},enforceMaxBoundingRect:function(t){var e,n,i;return e=this.getBoundingRect(t.ctx),i={x:-t.position.x/t.scale,y:-t.position.y/t.scale,width:t.canvas.width/t.scale,height:t.canvas.height/t.scale},e.x+e.width>i.x+i.width?(n=e.x-i.x,this.forcedWidth=i.width-n-10,this.renderer=null):void 0},getBoundingRect:function(t,e){if(null==e&&(e=!1),!this.renderer){if(!t)throw"Must pass ctx if text hasn't been rendered yet";this._makeRenderer(t)}return{x:this.x,y:this.y,width:this.renderer.getWidth(!0),height:this.renderer.getHeight()}},toJSON:function(){return{x:this.x,y:this.y,text:this.text,color:this.color,font:this.font,forcedWidth:this.forcedWidth,forcedHeight:this.forcedHeight,v:this.v}},fromJSON:function(t){return a("Text",t)}}),c("SelectionBox",{constructor:function(t){return null==t&&(t={}),this.shape=t.shape,this.handleSize=10,this.margin=4,this.backgroundColor=t.backgroundColor||null,this._br=this.shape.getBoundingRect(t.ctx)},getTopLeftHandleRect:function(){return{x:this._br.x-this.handleSize-this.margin,y:this._br.y-this.handleSize-this.margin,width:this.handleSize,height:this.handleSize}},getBottomLeftHandleRect:function(){return{x:this._br.x-this.handleSize-this.margin,y:this._br.y+this._br.height+this.margin,width:this.handleSize,height:this.handleSize}},getTopRightHandleRect:function(){return{x:this._br.x+this._br.width+this.margin,y:this._br.y-this.handleSize-this.margin,width:this.handleSize,height:this.handleSize}},getBottomRightHandleRect:function(){return{x:this._br.x+this._br.width+this.margin,y:this._br.y+this._br.height+this.margin,width:this.handleSize,height:this.handleSize}},getBoundingRect:function(){return{x:this._br.x-this.margin,y:this._br.y-this.margin,width:this._br.width+2*this.margin,height:this._br.height+2*this.margin}}}),e.exports={defineShape:c,createShape:a,JSONToShape:i,shapeToJSON:g}},{"./TextRenderer":3,"./canvasRenderer":6,"./lineEndCapShapes.coffee":8,"./svgRenderer":14,"./util":15}],14:[function(t,e,n){var i,o,r,s;o=t("./lineEndCapShapes.coffee"),s={},i=function(t,e){return s[t]=e},r=function(t,e){if(null==e&&(e={}),null==e.shouldIgnoreUnsupportedShapes&&(e.shouldIgnoreUnsupportedShapes=!1),s[t.className])return s[t.className](t);if(e.shouldIgnoreUnsupportedShapes)return console.warn("Can't render shape of type "+t.className+" to SVG"),"";throw"Can't render shape of type "+t.className+" to SVG"},i("Rectangle",function(t){var e,n;return e=t.x,n=t.y,t.strokeWidth%2!==0&&(e+=.5,n+=.5),"<rect x='"+e+"' y='"+n+"' width='"+t.width+"' height='"+t.height+"' stroke='"+t.strokeColor+"' fill='"+t.fillColor+"' stroke-width='"+t.strokeWidth+"' />"}),i("Ellipse",function(t){var e,n,i,o;return o=Math.floor(t.width/2),i=Math.floor(t.height/2),e=t.x+o,n=t.y+i,"<ellipse cx='"+e+"' cy='"+n+"' rx='"+o+"' ry='"+i+"' stroke='"+t.strokeColor+"' fill='"+t.fillColor+"' stroke-width='"+t.strokeWidth+"' />"}),i("Image",function(t){return"<image x='"+t.x+"' y='"+t.y+"' width='"+t.image.naturalWidth+"' height='"+t.image.naturalHeight+"' xlink:href='"+t.image.src+"' />"}),i("Line",function(t){var e,n,i,r,s,a,h;return i=t.dash?"stroke-dasharray='"+t.dash.join(", ")+"'":"",n="",e=Math.max(2.2*t.strokeWidth,5),r=t.x1,s=t.x2,a=t.y1,h=t.y2,t.strokeWidth%2!==0&&(r+=.5,s+=.5,a+=.5,h+=.5),t.endCapShapes[0]&&(n+=o[t.endCapShapes[0]].svg(r,a,Math.atan2(a-h,r-s),e,t.color)),t.endCapShapes[1]&&(n+=o[t.endCapShapes[1]].svg(s,h,Math.atan2(h-a,s-r),e,t.color)),"<g> <line x1='"+r+"' y1='"+a+"' x2='"+s+"' y2='"+h+"' "+i+" stroke-linecap='"+t.capStyle+"' stroke='"+t.color+"'stroke-width='"+t.strokeWidth+"' /> "+n+" <g>"}),i("LinePath",function(t){return"<polyline fill='none' points='"+t.smoothedPoints.map(function(t){var e;return e=t.strokeWidth%2===0?0:.5,""+(t.x+e)+","+(t.y+e)}).join(" ")+"' stroke='"+t.points[0].color+"' stroke-width='"+t.points[0].size+"' />"}),i("ErasedLinePath",function(t){return""}),i("Polygon",function(t){return t.isClosed?"<polygon fill='"+t.fillColor+"' points='"+t.points.map(function(t){var e;return e=t.strokeWidth%2===0?0:.5,""+(t.x+e)+","+(t.y+e)}).join(" ")+"' stroke='"+t.strokeColor+"' stroke-width='"+t.strokeWidth+"' />":"<polyline fill='"+t.fillColor+"' points='"+t.points.map(function(t){var e;return e=t.strokeWidth%2===0?0:.5,""+(t.x+e)+","+(t.y+e)}).join(" ")+"' stroke='none' /> <polyline fill='none' points='"+t.points.map(function(t){var e;return e=t.strokeWidth%2===0?0:.5,""+(t.x+e)+","+(t.y+e)}).join(" ")+"' stroke='"+t.strokeColor+"' stroke-width='"+t.strokeWidth+"' />"}),i("Text",function(t){var e,n,i;return i=t.forcedWidth?"width='"+t.forcedWidth+"px'":"",e=t.forcedHeight?"height='"+t.forcedHeight+"px'":"",n=t.text.split(/\r\n|\r|\n/g),t.renderer&&(n=t.renderer.lines),"<text x='"+t.x+"' y='"+t.y+"' "+i+" "+e+" fill='"+t.color+"' style='font: "+t.font+";'> "+n.map(function(e){return function(e,n){var i;return i=0===n?0:"1.2em","<tspan x='"+t.x+"' dy='"+i+"' alignment-baseline='text-before-edge'> "+e+" </tspan>"}}(this)).join("")+" </text>"}),e.exports={defineSVGRenderer:i,renderShapeToSVG:r}},{"./lineEndCapShapes.coffee":8}],15:[function(t,e,n){var i,o,r,s,a=[].slice;r=Array.prototype.slice,i=t("./canvasRenderer").renderShapeToContext,o=t("./svgRenderer").renderShapeToSVG,s={addImageOnload:function(t,e){var n;return n=t.onload,t.onload=function(){return"function"==typeof n&&n(),e()},t},last:function(t,e){return null==e&&(e=null),e?r.call(t,Math.max(t.length-e,0)):t[t.length-1]},classSet:function(t){var e,n;e=[];for(n in t)t[n]&&e.push(n);return e.join(" ")},matchElementSize:function(t,e,n,i){var o;return null==i&&(i=function(){}),o=function(o){return function(){var o,r,s;for(r=0,s=e.length;s>r;r++)o=e[r],o.style.width=""+t.offsetWidth+"px",o.style.height=""+t.offsetHeight+"px",null!=o.width&&(o.setAttribute("width",o.offsetWidth*n),o.setAttribute("height",o.offsetHeight*n));return i()}}(this),t.addEventListener("resize",o),window.addEventListener("resize",o),window.addEventListener("orientationchange",o),o()},combineCanvases:function(){var t,e,n,i,o,r,s,h;for(n=1<=arguments.length?a.call(arguments,0):[],t=document.createElement("canvas"),t.width=n[0].width,t.height=n[0].height,o=0,s=n.length;s>o;o++)e=n[o],t.width=Math.max(e.width,t.width),t.height=Math.max(e.height,t.height);for(i=t.getContext("2d"),r=0,h=n.length;h>r;r++)e=n[r],i.drawImage(e,0,0);return t},renderShapes:function(t,e,n,o){var r,s,a,h;for(null==n&&(n=1),null==o&&(o=null),o=o||document.createElement("canvas"),o.width=e.width*n,o.height=e.height*n,r=o.getContext("2d"),r.translate(-e.x*n,-e.y*n),r.scale(n,n),a=0,h=t.length;h>a;a++)s=t[a],i(r,s);return o},renderShapesToSVG:function(t,e,n){var i,r,s,a;return s=e.x,a=e.y,r=e.width,i=e.height,("<svg xmlns='http://www.w3.org/2000/svg' width='"+r+"' height='"+i+"' viewBox='0 0 "+r+" "+i+"'> <rect width='"+r+"' height='"+i+"' x='0' y='0' fill='"+n+"' /> <g transform='translate("+-s+", "+-a+")'> "+t.map(o).join("")+" </g> </svg>").replace(/(\r\n|\n|\r)/gm,"")},getBoundingRect:function(t,e,n){var i,o,r,s,a,h,l;if(!t.length)return{x:0,y:0,width:e,height:n};for(r=t[0].x,s=t[0].y,i=t[0].x+t[0].width,o=t[0].y+t[0].height,h=0,l=t.length;l>h;h++)a=t[h],r=Math.floor(Math.min(a.x,r)),s=Math.floor(Math.min(a.y,s)),i=Math.ceil(Math.max(i,a.x+a.width)),o=Math.ceil(Math.max(o,a.y+a.height));return r=e?0:r,s=n?0:s,i=e||i,o=n||o,{x:r,y:s,width:i-r,height:o-s}},getBackingScale:function(t){return null==window.devicePixelRatio?1:window.devicePixelRatio>1?window.devicePixelRatio:1},requestAnimationFrame:(window.requestAnimationFrame||window.setTimeout).bind(window),getGUID:function(){var t;return t=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},function(){return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}}()},e.exports=s},{"./canvasRenderer":6,"./svgRenderer":14}],16:[function(t,e,n){!function(){function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n}t.prototype=window.CustomEvent.prototype,window.CustomEvent=t}()},{}],17:[function(t,e,n){var i=!1;CanvasRenderingContext2D.prototype.setLineDash||(CanvasRenderingContext2D.prototype.setLineDash=function(){i||(console.warn("context2D.setLineDash is a no-op in this browser."),i=!0)}),e.exports=null},{}],18:[function(t,e,n){var i,o,r,s,a,h,l,c,u,p,d,f,g,m,y,S,v,x;t("./ie_customevent"),t("./ie_setLineDash"),i=t("./core/LiterallyCanvas"),u=t("./reactGUI/init"),r=t("./core/canvasRenderer"),S=t("./core/svgRenderer"),y=t("./core/shapes"),x=t("./core/util"),f=t("./core/renderSnapshotToImage"),g=t("./core/renderSnapshotToSVG"),p=t("./core/localization").localize,t("./optionsStyles/font"),t("./optionsStyles/stroke-width"),t("./optionsStyles/line-options-and-stroke-width"),t("./optionsStyles/null"),l=t("./optionsStyles/optionsStyles").defineOptionsStyle,s={snapshotToShapes:function(t){var e,n,i,o,r;for(o=t.shapes,r=[],n=0,i=o.length;i>n;n++)e=o[n],r.push(y.JSONToShape(e));return r},snapshotJSONToShapes:function(t){return s.snapshotToShapes(JSON.parse(t))}},o=t("./tools/base"),v={Pencil:t("./tools/Pencil"),Eraser:t("./tools/Eraser"),Line:t("./tools/Line"),Rectangle:t("./tools/Rectangle"),Ellipse:t("./tools/Ellipse"),Text:t("./tools/Text"),Polygon:t("./tools/Polygon"),Pan:t("./tools/Pan"),Eyedropper:t("./tools/Eyedropper"),Tool:o.Tool,ToolWithStroke:o.ToolWithStroke},h=[v.Pencil,v.Eraser,v.Line,v.Rectangle,v.Ellipse,v.Text,v.Polygon,v.Pan,v.Eyedropper],a="lib/img",m=function(t){return a=t},c=function(t,e){var n,o,r,s,l,c,p,d,f,g;null==e&&(e={}),null==e.imageURLPrefix&&(e.imageURLPrefix=a),null==e.primaryColor&&(e.primaryColor="#000"),null==e.secondaryColor&&(e.secondaryColor="#fff"),null==e.backgroundColor&&(e.backgroundColor="transparent"),null==e.strokeWidths&&(e.strokeWidths=[1,2,5,10,20,30]),null==e.defaultStrokeWidth&&(e.defaultStrokeWidth=5),null==e.toolbarPosition&&(e.toolbarPosition="top"),null==e.keyboardShortcuts&&(e.keyboardShortcuts=!0),null==e.imageSize&&(e.imageSize={width:"infinite",height:"infinite"}),null==e.backgroundShapes&&(e.backgroundShapes=[]),null==e.watermarkImage&&(e.watermarkImage=null),null==e.watermarkScale&&(e.watermarkScale=1),null==e.zoomMin&&(e.zoomMin=.2),null==e.zoomMax&&(e.zoomMax=4),null==e.zoomStep&&(e.zoomStep=.2),null==e.snapshot&&(e.snapshot=null),"tools"in e||(e.tools=h),g=t.children;for(d=0,f=g.length;f>d;d++)n=g[d],t.removeChild(n);return-1===[" "," "].join(t.className).indexOf(" literally ")&&(t.className=t.className+" literally"),p="top"===e.toolbarPosition?"toolbar-at-top":"bottom"===e.toolbarPosition?"toolbar-at-bottom":"hidden"===e.toolbarPosition?"toolbar-hidden":void 0,t.className=t.className+" "+p,l=document.createElement("div"),l.className="lc-picker",o=document.createElement("div"),o.className="lc-drawing",s=document.createElement("div"),s.className="lc-options horz-toolbar",t.appendChild(l),t.appendChild(o),t.appendChild(s),r=new i(o,e),u(l,s,r,e.tools,e.imageURLPrefix),"onInit"in e&&e.onInit(r),c=function(){return r._teardown(),l.remove(),o.remove(),s.remove()},r.teardown=c,r},d=function(t){return t.fn.literallycanvas=function(t){return null==t&&(t={}),this.each(function(e){return function(e,n){return n.literallycanvas=c(n,t)}}(this)),this}},window.LC={init:c},window.$&&d(window.$),e.exports={init:c,registerJQueryPlugin:d,util:x,tools:v,defineOptionsStyle:l,setDefaultImageURLPrefix:m,defaultTools:h,defineShape:y.defineShape,createShape:y.createShape,JSONToShape:y.JSONToShape,shapeToJSON:y.shapeToJSON,defineCanvasRenderer:r.defineCanvasRenderer,renderShapeToContext:r.renderShapeToContext,renderShapeToCanvas:r.renderShapeToCanvas,renderShapesToCanvas:x.renderShapes,defineSVGRenderer:S.defineSVGRenderer,renderShapeToSVG:S.renderShapeToSVG,renderShapesToSVG:x.renderShapesToSVG,snapshotToShapes:s.snapshotToShapes,snapshotJSONToShapes:s.snapshotJSONToShapes,renderSnapshotToImage:f,renderSnapshotToSVG:g,localize:p}},{"./core/LiterallyCanvas":2,"./core/canvasRenderer":6,"./core/localization":9,"./core/renderSnapshotToImage":11,"./core/renderSnapshotToSVG":12,"./core/shapes":13,"./core/svgRenderer":14,"./core/util":15,"./ie_customevent":16,"./ie_setLineDash":17,"./optionsStyles/font":19,"./optionsStyles/line-options-and-stroke-width":20,"./optionsStyles/null":21,"./optionsStyles/optionsStyles":22,"./optionsStyles/stroke-width":23,"./reactGUI/init":34,"./tools/Ellipse":35,"./tools/Eraser":36,"./tools/Eyedropper":37,"./tools/Line":38,"./tools/Pan":39,"./tools/Pencil":40,"./tools/Polygon":41,"./tools/Rectangle":42,"./tools/Text":43,"./tools/base":44}],19:[function(t,e,n){var i,o;i=t("./optionsStyles").defineOptionsStyle,o=t("../core/localization")._,i("font",React.createClass({displayName:"FontOptions",getInitialState:function(){return{isItalic:!1,isBold:!1,fontFamilyIndex:0,fontSizeIndex:4}},getFontSizes:function(){return[9,10,12,14,18,24,36,48,64,72,96,144,288]},getFamilies:function(){var t;return t=this.props.lc,[{name:o("Sans-serif"),value:'"Helvetica Neue",Helvetica,Arial,sans-serif'},{name:o("Serif"),value:'"Hoefler Text","Times New Roman",serif'},{name:o("Typewriter"),value:'"Lucida Typewriter",monospace'}]},updateTool:function(t){var e,n,i;null==t&&(t={});for(i in this.state)i in t||(t[i]=this.state[i]);return e=this.getFontSizes()[t.fontSizeIndex],n=[],t.isItalic&&n.push("italic"),t.isBold&&n.push("bold"),n.push(""+e+"px"),n.push(this.getFamilies()[t.fontFamilyIndex].value),this.props.lc.tool.font=n.join(" "),this.props.lc.trigger("setFont",n.join(" "))},handleFontSize:function(t){var e;return e={fontSizeIndex:t.target.value},this.setState(e),this.updateTool(e)},handleFontFamily:function(t){var e;return e={fontFamilyIndex:t.target.value},this.setState(e),this.updateTool(e)},handleItalic:function(t){var e;return e={isItalic:!this.state.isItalic},this.setState(e),this.updateTool(e)},handleBold:function(t){var e;return e={isBold:!this.state.isBold},this.setState(e),this.updateTool(e)},componentDidMount:function(){return this.updateTool()},render:function(){var t,e,n,i,r,s,a,h,l;return r=this.props.lc,l=React.DOM,e=l.div,n=l.input,a=l.select,s=l.option,t=l.br,i=l.label,h=l.span,e({className:"lc-font-settings"},a({value:this.state.fontSizeIndex,onChange:this.handleFontSize},this.getFontSizes().map(function(t){return function(t,e){return s({value:e,key:e},""+t+"px")}}(this))),a({value:this.state.fontFamilyIndex,onChange:this.handleFontFamily},this.getFamilies().map(function(t){return function(t,e){return s({value:e,key:e},t.name)}}(this))),i({htmlFor:"italic"},n({type:"checkbox",id:"italic",checked:this.state.isItalic,onChange:this.handleItalic},o("italic"))),i({htmlFor:"bold"},n({type:"checkbox",id:"bold",checked:this.state.isBold,onChange:this.handleBold},o("bold"))))}})),e.exports={}},{"../core/localization":9,"./optionsStyles":22}],20:[function(t,e,n){var i,o,r,s;s=t("./optionsStyles").defineOptionsStyle,i=React.createFactory(t("../reactGUI/StrokeWidthPicker")),r=t("../reactGUI/createSetStateOnEventMixin"),o=t("../core/util").classSet,s("line-options-and-stroke-width",React.createClass({displayName:"LineOptionsAndStrokeWidth",getState:function(){return{strokeWidth:this.props.tool.strokeWidth,isDashed:this.props.tool.isDashed,hasEndArrow:this.props.tool.hasEndArrow}},getInitialState:function(){return this.getState()},mixins:[r("toolChange")],render:function(){var t,e,n,r,s,a,h,l,c,u;return u=React.DOM,n=u.div,c=u.ul,s=u.li,r=u.img,h=function(t){return function(){return t.props.tool.isDashed=!t.props.tool.isDashed,t.setState(t.getState())}}(this),l=function(t){return function(){return t.props.tool.hasEndArrow=!t.props.tool.hasEndArrow,t.setState(t.getState())}}(this),e=o({"square-toolbar-button":!0,selected:this.state.isDashed}),t=o({"square-toolbar-button":!0,selected:this.state.hasEndArrow}),a={"float":"left",margin:1},n({},n({className:e,onClick:h,style:a},r({src:""+this.props.imageURLPrefix+"/dashed-line.png"})),n({className:t,onClick:l,style:a},r({src:""+this.props.imageURLPrefix+"/line-with-arrow.png"})),i({tool:this.props.tool,lc:this.props.lc}))}})),e.exports={}},{"../core/util":15,"../reactGUI/StrokeWidthPicker":29,"../reactGUI/createSetStateOnEventMixin":32,"./optionsStyles":22}],21:[function(t,e,n){var i;i=t("./optionsStyles").defineOptionsStyle,i("null",React.createClass({displayName:"NoOptions",render:function(){return React.DOM.div()}})),e.exports={}},{"./optionsStyles":22}],22:[function(t,e,n){var i,o;o={},i=function(t,e){return o[t]=React.createFactory(e)},e.exports={optionsStyles:o,defineOptionsStyle:i}},{}],23:[function(t,e,n){var i,o;o=t("./optionsStyles").defineOptionsStyle,i=t("../reactGUI/StrokeWidthPicker"),o("stroke-width",i),e.exports={}},{"../reactGUI/StrokeWidthPicker":29,"./optionsStyles":22}],24:[function(t,e,n){var i,o,r,s,a;o=t("./React-shim"),s=t("./createSetStateOnEventMixin"),a=t("../core/localization")._,r=t("../core/util").classSet,i=o.createClass({displayName:"ClearButton",getState:function(){return{isEnabled:this.props.lc.canUndo()}},getInitialState:function(){return this.getState()},mixins:[s("drawingChange")],render:function(){var t,e,n,i;return e=o.DOM.div,n=this.props.lc,t=r({"lc-clear":!0,"toolbar-button":!0,"fat-button":!0,disabled:!this.state.isEnabled}),i=n.canUndo()?function(t){return function(){return n.clear()}}(this):function(){},e({className:t,onClick:i},a("Clear"))}}),e.exports=i},{"../core/localization":9,"../core/util":15,"./React-shim":28,"./createSetStateOnEventMixin":32}],25:[function(t,e,n){var i,o,r;o=t("./React-shim"),r=t("../core/util").classSet,i=o.createClass({displayName:"ColorWell",getState:function(){return{color:this.props.lc.colors[this.props.colorName],isPickerVisible:!1}},getInitialState:function(){return this.getState()},componentDidMount:function(){return this.unsubscribe=this.props.lc.on(""+this.props.colorName+"ColorChange",function(t){return function(){return t.setState({color:t.props.lc.colors[t.props.colorName]})}}(this))},componentWillUnmount:function(){return this.unsubscribe()},togglePicker:function(){return this.setState({isPickerVisible:!this.state.isPickerVisible})},closePicker:function(){return this.setState({isPickerVisible:!1})},setColor:function(t){return this.props.lc.setColor(this.props.colorName,t)},render:function(){var t,e,n,i;return i=o.DOM,e=i.div,n=i.label,t=i.br,e({className:r({"color-well":!0,open:this.state.isPickerVisible}),onMouseLeave:this.closePicker,onClick:this.togglePicker,style:{"float":"left",textAlign:"center"}},n({"float":"left"},this.props.label),t({}),e({className:r({"color-well-color-container":!0,selected:this.state.isPickerVisible}),style:{backgroundColor:"white"}},e({className:"color-well-checker color-well-checker-top-left"}),e({className:"color-well-checker color-well-checker-bottom-right",style:{left:"50%",top:"50%"}}),e({className:"color-well-color",style:{backgroundColor:this.state.color}}," ")),this.renderPicker())},renderPicker:function(){var t,e,n,i,s,a,h,l;if(t=o.DOM.div,!this.state.isPickerVisible)return null;for(i=function(e){return function(){return t({className:"color-row",key:0,style:{height:20}},t({className:r({"color-cell transparent-cell":!0,selected:"transparent"===e.state.color}),onClick:function(){return e.setColor("transparent")}},"transparent"))}}(this),s=[],s.push("transparent"),s.push(function(){var t,e;for(e=[],n=t=0;100>=t;n=t+=10)e.push("hsl(0, 0%, "+n+"%)");return e}()),l=[0,30,60,90,120,150,180,210,240,270,300,330],a=0,h=l.length;h>a;a++)e=l[a],s.push(function(){var t,i;for(i=[],n=t=10;90>=t;n=t+=8)i.push("hsl("+e+", 100%, "+n+"%)");return i}());return t({className:"color-picker-popup"},s.map(function(e){return function(n,o){return"transparent"===n?i():t({className:"color-row",key:o,style:{width:20*n.length}},n.map(function(n,i){var o;return o=r({"color-cell":!0,selected:e.state.color===n}),t({className:o,onClick:function(){return e.setColor(n)},style:{backgroundColor:n},key:i})}))}}(this)))}}),e.exports=i},{"../core/util":15,"./React-shim":28}],26:[function(t,e,n){var i,o,r,s;o=t("./React-shim"),r=t("./createSetStateOnEventMixin"),s=t("../optionsStyles/optionsStyles").optionsStyles,i=o.createClass({displayName:"Options",getState:function(){var t;return{style:null!=(t=this.props.lc.tool)?t.optionsStyle:void 0,tool:this.props.lc.tool}},getInitialState:function(){return this.getState()},mixins:[r("toolChange")],render:function(){var t,e;return t=o.DOM.div,e=""+this.state.style,s[e]({lc:this.props.lc,tool:this.state.tool,imageURLPrefix:this.props.imageURLPrefix})}}),e.exports=i},{"../optionsStyles/optionsStyles":22,"./React-shim":28,"./createSetStateOnEventMixin":32}],27:[function(t,e,n){var i,o,r,s,a,h,l,c;a=t("./React-shim"),i=a.createFactory(t("./ClearButton")),h=a.createFactory(t("./UndoRedoButtons")),l=a.createFactory(t("./ZoomButtons")),c=t("../core/localization")._,r=a.createFactory(t("./ColorWell")),o=a.createFactory(a.createClass({displayName:"ColorPickers",render:function(){var t,e;return e=this.props.lc,(t=a.DOM.div)({className:"lc-color-pickers"},r({lc:e,colorName:"primary",label:c("stroke")}),r({lc:e,colorName:"secondary",label:c("fill")}),r({lc:e,colorName:"background",label:c("bg")}))}})),s=a.createClass({displayName:"Picker",getInitialState:function(){return{selectedToolIndex:0}},render:function(){var t,e,n,r,s;return t=a.DOM.div,s=this.props,r=s.toolButtonComponents,n=s.lc,e=s.imageURLPrefix,t({className:"lc-picker-contents"},r.map(function(t){return function(i,o){return i({lc:n,imageURLPrefix:e,key:o,isSelected:o===t.state.selectedToolIndex,onSelect:function(e){return n.setTool(e),t.setState({selectedToolIndex:o})}})}}(this)),r.length%2!==0?t({className:"toolbar-button thin-button disabled"}):void 0,t({style:{position:"absolute",bottom:0,left:0,right:0}},o({lc:this.props.lc}),h({lc:n,imageURLPrefix:e}),l({lc:n,imageURLPrefix:e}),i({lc:n})))}}),e.exports=s},{"../core/localization":9,"./ClearButton":24,"./ColorWell":25,"./React-shim":28,"./UndoRedoButtons":30,"./ZoomButtons":31}],28:[function(t,e,n){var i;try{i=t("React/addons")}catch(o){i=window.React}if(null==(null!=i?i.addons:void 0))throw"Can't find React (you need the version with addons)";e.exports=i},{}],29:[function(t,e,n){var i,o;o=t("../reactGUI/createSetStateOnEventMixin"),i=t("../core/util").classSet,e.exports=React.createClass({displayName:"StrokeWidthPicker",getState:function(){return{strokeWidth:this.props.tool.strokeWidth}},getInitialState:function(){return this.getState()},mixins:[o("toolChange")],render:function(){var t,e,n,o,r,s,a;return a=React.DOM,s=a.ul,n=a.li,r=a.svg,t=a.circle,e=a.div,o=this.props.lc.opts.strokeWidths,e({},o.map(function(n){return function(o,s){var a,h;return a=i({"square-toolbar-button":!0,selected:o===n.state.strokeWidth}),h=28,e({key:o},e({className:a,onClick:function(){return n.props.tool.strokeWidth=o,n.setState(n.getState())}},r({width:h-2,height:h-2,viewPort:"0 0 "+o+" "+o,version:"1.1",xmlns:"http://www.w3.org/2000/svg"},t({cx:Math.ceil(h/2-1),cy:Math.ceil(h/2-1),r:o/2}))))}}(this)))}})},{"../core/util":15,"../reactGUI/createSetStateOnEventMixin":32}],30:[function(t,e,n){var i,o,r,s,a,h,l;i=t("./React-shim"),h=t("./createSetStateOnEventMixin"),a=t("../core/util").classSet,l=function(t){return i.createClass({displayName:"undo"===t?"UndoButton":"RedoButton",getState:function(){return{isEnabled:function(){switch(!1){case"undo"!==t:return this.props.lc.canUndo();case"redo"!==t:return this.props.lc.canRedo()}}.call(this)}},getInitialState:function(){return this.getState()},mixins:[h("drawingChange")],render:function(){var e,n,o,r,s,h,l,c,u,p,d;return p=i.DOM,n=p.div,r=p.img,d=this.props,s=d.lc,o=d.imageURLPrefix,u="undo"===t?"Undo":"Redo",e="lc-"+t+" "+a({"toolbar-button":!0,"thin-button":!0,disabled:!this.state.isEnabled}),h=function(){switch(!1){case!!this.state.isEnabled:return function(){};case"undo"!==t:return function(){return s.undo()};case"redo"!==t:return function(){return s.redo()}}}.call(this),l=""+o+"/"+t+".png",c={backgroundImage:"url("+l+")"},n({className:e,onClick:h,title:u,style:c})}})},r=i.createFactory(l("undo")),o=i.createFactory(l("redo")),s=i.createClass({displayName:"UndoRedoButtons",render:function(){var t;return(t=i.DOM.div)({className:"lc-undo-redo"},r(this.props),o(this.props))}}),e.exports=s},{"../core/util":15,"./React-shim":28,"./createSetStateOnEventMixin":32}],31:[function(t,e,n){var i,o,r,s,a,h,l;i=t("./React-shim"),h=t("./createSetStateOnEventMixin"),a=t("../core/util").classSet,l=function(t){return i.createClass({displayName:"in"===t?"ZoomInButton":"ZoomOutButton",getState:function(){return{isEnabled:function(){switch(!1){case"in"!==t:return this.props.lc.scale<this.props.lc.config.zoomMax;
case"out"!==t:return this.props.lc.scale>this.props.lc.config.zoomMin}}.call(this)}},getInitialState:function(){return this.getState()},mixins:[h("zoom")],render:function(){var e,n,o,r,s,h,l,c,u,p,d;return p=i.DOM,n=p.div,r=p.img,d=this.props,s=d.lc,o=d.imageURLPrefix,u="in"===t?"Zoom in":"Zoom out",e="lc-zoom-"+t+" "+a({"toolbar-button":!0,"thin-button":!0,disabled:!this.state.isEnabled}),h=function(){switch(!1){case!!this.state.isEnabled:return function(){};case"in"!==t:return function(){return s.zoom(s.config.zoomStep)};case"out"!==t:return function(){return s.zoom(-s.config.zoomStep)}}}.call(this),l=""+o+"/zoom-"+t+".png",c={backgroundImage:"url("+l+")"},n({className:e,onClick:h,title:u,style:c})}})},s=i.createFactory(l("out")),r=i.createFactory(l("in")),o=i.createClass({displayName:"ZoomButtons",render:function(){var t;return(t=i.DOM.div)({className:"lc-zoom"},s(this.props),r(this.props))}}),e.exports=o},{"../core/util":15,"./React-shim":28,"./createSetStateOnEventMixin":32}],32:[function(t,e,n){var i,o;i=t("./React-shim"),e.exports=o=function(t){return{componentDidMount:function(){return this.unsubscribe=this.props.lc.on(t,function(t){return function(){return t.setState(t.getState())}}(this))},componentWillUnmount:function(){return this.unsubscribe()}}}},{"./React-shim":28}],33:[function(t,e,n){var i,o,r;i=t("./React-shim"),o=t("../core/util").classSet,r=function(t){var e,n,r,s;return e=t.displayName,n=t.getTool,r=t.imageName,s=n(),i.createFactory(i.createClass({displayName:e,getDefaultProps:function(){return{isSelected:!1,lc:null}},componentWillMount:function(){return this.props.isSelected?this.props.lc.setTool(s):void 0},render:function(){var t,n,a,h,l,c,u,p,d;return p=i.DOM,n=p.div,h=p.img,d=this.props,a=d.imageURLPrefix,l=d.isSelected,c=d.onSelect,t=o({"lc-pick-tool":!0,"toolbar-button":!0,"thin-button":!0,selected:l}),u=""+a+"/"+r+".png",n({className:t,style:{backgroundImage:"url("+u+")"},onClick:function(){return c(s)},title:e})}}))},e.exports=r},{"../core/util":15,"./React-shim":28}],34:[function(t,e,n){var i,o,r,s,a;r=t("./React-shim"),s=t("./createToolButton"),i=r.createFactory(t("./Options")),o=r.createFactory(t("./Picker")),a=function(t,e,n,a,h){var l;return l=a.map(function(t){var e;return e=new t(n),s({displayName:e.name,imageName:e.iconName,getTool:function(){return e}})}),r.render(o({lc:n,toolButtonComponents:l,imageURLPrefix:h}),t),r.render(i({lc:n,imageURLPrefix:h}),e)},e.exports=a},{"./Options":26,"./Picker":27,"./React-shim":28,"./createToolButton":33}],35:[function(t,e,n){var i,o,r,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=t("./base").ToolWithStroke,r=t("../core/shapes").createShape,e.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.name="Ellipse",e.prototype.iconName="ellipse",e.prototype.begin=function(t,e,n){return this.currentShape=r("Ellipse",{x:t,y:e,strokeWidth:this.strokeWidth,strokeColor:n.getColor("primary"),fillColor:n.getColor("secondary")})},e.prototype["continue"]=function(t,e,n){return this.currentShape.width=t-this.currentShape.x,this.currentShape.height=e-this.currentShape.y,n.drawShapeInProgress(this.currentShape)},e.prototype.end=function(t,e,n){return n.saveShape(this.currentShape)},e}(o)},{"../core/shapes":13,"./base":44}],36:[function(t,e,n){var i,o,r,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=t("./Pencil"),r=t("../core/shapes").createShape,e.exports=i=function(t){function e(){this.strokeWidth=10}return a(e,t),e.prototype.name="Eraser",e.prototype.iconName="eraser",e.prototype.makePoint=function(t,e,n){return r("Point",{x:t,y:e,size:this.strokeWidth,color:"#000"})},e.prototype.makeShape=function(){return r("ErasedLinePath")},e}(o)},{"../core/shapes":13,"./Pencil":40}],37:[function(t,e,n){var i,o,r={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=t("./base").Tool,e.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.name="Eyedropper",e.prototype.iconName="eyedropper",e.prototype.readColor=function(t,e,n){var i;return i=n.getPixel(t,e),n.setColor("primary",i||n.getColor("background"))},e.prototype.begin=function(t,e,n){return this.readColor(t,e,n)},e.prototype["continue"]=function(t,e,n){return this.readColor(t,e,n)},e}(o)},{"./base":44}],38:[function(t,e,n){var i,o,r,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=t("./base").Tool,r=t("../core/shapes").createShape,e.exports=i=function(t){function e(){this.strokeWidth=5}return a(e,t),e.prototype.name="Line",e.prototype.iconName="line",e.prototype.optionsStyle="line-options-and-stroke-width",e.prototype.begin=function(t,e,n){return this.currentShape=r("Line",{x1:t,y1:e,x2:t,y2:e,strokeWidth:this.strokeWidth,dash:function(){switch(!1){case!this.isDashed:return[2*this.strokeWidth,4*this.strokeWidth];default:return null}}.call(this),endCapShapes:this.hasEndArrow?[null,"arrow"]:null,color:n.getColor("primary")})},e.prototype["continue"]=function(t,e,n){return this.currentShape.x2=t,this.currentShape.y2=e,n.drawShapeInProgress(this.currentShape)},e.prototype.end=function(t,e,n){return n.saveShape(this.currentShape)},e}(o)},{"../core/shapes":13,"./base":44}],39:[function(t,e,n){var i,o,r,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=t("./base").Tool,r=t("../core/shapes").createShape,e.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.name="Pan",e.prototype.iconName="pan",e.prototype.usesSimpleAPI=!1,e.prototype.didBecomeActive=function(t){var e;return e=[],this.unsubscribe=function(t){return function(){var t,n,i,o;for(o=[],n=0,i=e.length;i>n;n++)t=e[n],o.push(t());return o}}(this),e.push(t.on("lc-pointerdown",function(e){return function(n){var i,o;return i=n.rawX,o=n.rawY,e.oldPosition=t.position,e.pointerStart={x:i,y:o}}}(this))),e.push(t.on("lc-pointerdrag",function(e){return function(n){var i,o,r;return o=n.rawX,r=n.rawY,i={x:(o-e.pointerStart.x)*t.backingScale,y:(r-e.pointerStart.y)*t.backingScale},t.setPan(e.oldPosition.x+i.x,e.oldPosition.y+i.y)}}(this)))},e.prototype.willBecomeInactive=function(t){return this.unsubscribe()},e}(o)},{"../core/shapes":13,"./base":44}],40:[function(t,e,n){var i,o,r,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=t("./base").ToolWithStroke,r=t("../core/shapes").createShape,e.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.name="Pencil",e.prototype.iconName="pencil",e.prototype.eventTimeThreshold=10,e.prototype.begin=function(t,e,n){return this.color=n.getColor("primary"),this.currentShape=this.makeShape(),this.currentShape.addPoint(this.makePoint(t,e,n)),this.lastEventTime=Date.now()},e.prototype["continue"]=function(t,e,n){var i;return i=Date.now()-this.lastEventTime,i>this.eventTimeThreshold?(this.lastEventTime+=i,this.currentShape.addPoint(this.makePoint(t,e,n)),n.drawShapeInProgress(this.currentShape)):void 0},e.prototype.end=function(t,e,n){return n.saveShape(this.currentShape),this.currentShape=void 0},e.prototype.makePoint=function(t,e,n){return r("Point",{x:t,y:e,size:this.strokeWidth,color:this.color})},e.prototype.makeShape=function(){return r("LinePath")},e}(o)},{"../core/shapes":13,"./base":44}],41:[function(t,e,n){var i,o,r,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=t("./base").ToolWithStroke,r=t("../core/shapes").createShape,e.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.name="Polygon",e.prototype.iconName="polygon",e.prototype.usesSimpleAPI=!1,e.prototype.didBecomeActive=function(t){var e,n,i,o;return o=[],this.unsubscribe=function(t){return function(){var t,e,n,i;for(i=[],e=0,n=o.length;n>e;e++)t=o[e],i.push(t());return i}}(this),this.points=null,this.maybePoint=null,i=function(e){return function(){return e._getWillFinish()?e._close(t):(e.points||e._ensureFinishButtonsExist(t),e.points?e.points.push(e.maybePoint):e.points=[e.maybePoint],e.maybePoint={x:e.maybePoint.x,y:e.maybePoint.y},t.setShapesInProgress(e._getShapes(t)),t.repaintLayer("main"))}}(this),n=function(e){return function(n){var i,o;return i=n.x,o=n.y,e.maybePoint?(e.maybePoint.x=i,e.maybePoint.y=o,t.setShapesInProgress(e._getShapes(t)),t.repaintLayer("main")):void 0}}(this),e=function(e){return function(n){var i,o;return i=n.x,o=n.y,e.maybePoint={x:i,y:o},t.setShapesInProgress(e._getShapes(t)),t.repaintLayer("main")}}(this),o.push(t.on("drawingChange",function(e){return function(){return e._cancel(t)}}(this))),o.push(t.on("lc-pointerdown",e)),o.push(t.on("lc-pointerdrag",n)),o.push(t.on("lc-pointermove",n)),o.push(t.on("lc-pointerup",i))},e.prototype.willBecomeInactive=function(t){return(this.points||this.maybePoint)&&this._cancel(t),this.unsubscribe()},e.prototype._getArePointsClose=function(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)<10},e.prototype._getWillClose=function(){return this.points&&this.points.length>1&&this.maybePoint?this._getArePointsClose(this.points[0],this.maybePoint):!1},e.prototype._getWillFinish=function(){return this.points&&this.points.length>1&&this.maybePoint?this._getArePointsClose(this.points[0],this.maybePoint)||this._getArePointsClose(this.points[this.points.length-1],this.maybePoint):!1},e.prototype._cancel=function(t){return this._ensureFinishButtonsDontExist(t),this.maybePoint=null,this.points=null,t.setShapesInProgress([]),t.repaintLayer("main")},e.prototype._close=function(t){return this._ensureFinishButtonsDontExist(t),t.setShapesInProgress([]),this.points.length>2&&t.saveShape(this._getShape(t,!1)),this.maybePoint=null,this.points=null},e.prototype._getShapes=function(t,e){var n;return null==e&&(e=!0),n=this._getShape(t,e),n?[n]:[]},e.prototype._getShape=function(t,e){var n;return null==e&&(e=!0),n=[],this.points&&(n=n.concat(this.points)),!e&&n.length<3?null:(e&&this.maybePoint&&n.push(this.maybePoint),n.length>1?r("Polygon",{isClosed:this._getWillClose(),strokeColor:t.getColor("primary"),fillColor:t.getColor("secondary"),strokeWidth:this.strokeWidth,points:n.map(function(t){return r("Point",t)})}):null)},e.prototype._ensureFinishButtonsExist=function(t){var e;if(!this.containerEl)return e="<div class='square-toolbar-button horz-toolbar' id='polygon-finish-closed'> <img alt='Finish polygon (closed)' title='Finish polygon (closed)' src='"+t.opts.imageURLPrefix+"/polygon-closed.png'> </div> <div class='square-toolbar-button horz-toolbar' id='polygon-finish-open'> <img alt='Finish polygon (open)' title='Finish polygon (open)' src='"+t.opts.imageURLPrefix+"/polygon-open.png'> </div> <div class='square-toolbar-button horz-toolbar' id='polygon-cancel'> <img alt='Cancel polygon' title='Cancel polygon' src='"+t.opts.imageURLPrefix+"/polygon-cancel.png'> </div>",this.containerEl=document.createElement("div"),this.containerEl.className="polygon-toolbar horz-toolbar",this.containerEl.innerHTML=e,t.containerEl.appendChild(this.containerEl),document.getElementById("polygon-finish-closed").addEventListener("click",function(e){return function(n){return e.maybePoint=e.points[0],e._close(t)}}(this)),document.getElementById("polygon-finish-open").addEventListener("click",function(e){return function(n){return e.maybePoint={x:1/0,y:1/0},e._close(t)}}(this)),document.getElementById("polygon-cancel").addEventListener("click",function(e){return function(n){return e._cancel(t)}}(this))},e.prototype._ensureFinishButtonsDontExist=function(t){return this.containerEl?(t.containerEl.removeChild(this.containerEl),this.containerEl=null):void 0},e}(o)},{"../core/shapes":13,"./base":44}],42:[function(t,e,n){var i,o,r,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=t("./base").ToolWithStroke,r=t("../core/shapes").createShape,e.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.name="Rectangle",e.prototype.iconName="rectangle",e.prototype.begin=function(t,e,n){return this.currentShape=r("Rectangle",{x:t,y:e,strokeWidth:this.strokeWidth,strokeColor:n.getColor("primary"),fillColor:n.getColor("secondary")})},e.prototype["continue"]=function(t,e,n){return this.currentShape.width=t-this.currentShape.x,this.currentShape.height=e-this.currentShape.y,n.drawShapeInProgress(this.currentShape)},e.prototype.end=function(t,e,n){return n.saveShape(this.currentShape)},e}(o)},{"../core/shapes":13,"./base":44}],43:[function(t,e,n){var i,o,r,s,a={}.hasOwnProperty,h=function(t,e){function n(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=t("./base").Tool,r=t("../core/shapes").createShape,s=function(t,e){return t.x<e.x?!1:t.y<e.y?!1:t.x>e.x+e.width?!1:t.y>e.y+e.height?!1:!0},e.exports=i=function(t){function e(){this.text="",this.font="bold 18px sans-serif",this.currentShape=null,this.currentShapeState=null,this.initialShapeBoundingRect=null,this.dragAction=null,this.didDrag=!1}return h(e,t),e.prototype.name="Text",e.prototype.iconName="text",e.prototype.didBecomeActive=function(t){var e,n,i;return n=[],this.unsubscribe=function(t){return function(){var t,e,i,o;for(o=[],e=0,i=n.length;i>e;e++)t=n[e],o.push(t());return o}}(this),e=function(e){return function(){return e._ensureNotEditing(t),e._clearCurrentShape(t),t.repaintLayer("main")}}(this),i=function(e){return function(){return e._updateInputEl(t)}}(this),n.push(t.on("drawingChange",e)),n.push(t.on("zoom",i)),n.push(t.on("imageSizeChange",i)),n.push(t.on("snapshotLoad",function(e){return function(){return e._clearCurrentShape(t),t.repaintLayer("main")}}(this))),n.push(t.on("primaryColorChange",function(e){return function(n){return e.currentShape?(e.currentShape.color=n,e._updateInputEl(t),t.repaintLayer("main")):void 0}}(this))),n.push(t.on("setFont",function(e){return function(n){return e.currentShape?(e.font=n,e.currentShape.setFont(n),e._setShapesInProgress(t),e._updateInputEl(t),t.repaintLayer("main")):void 0}}(this)))},e.prototype.willBecomeInactive=function(t){return this.currentShape&&(this._ensureNotEditing(t),this.commit(t)),this.unsubscribe()},e.prototype.setText=function(t){return this.text=t},e.prototype._ensureNotEditing=function(t){return"editing"===this.currentShapeState?this._exitEditingState(t):void 0},e.prototype._clearCurrentShape=function(t){return this.currentShape=null,this.initialShapeBoundingRect=null,this.currentShapeState=null,t.setShapesInProgress([])},e.prototype.commit=function(t){return this.currentShape.text&&t.saveShape(this.currentShape),this._clearCurrentShape(t),t.repaintLayer("main")},e.prototype._getSelectionShape=function(t,e){return null==e&&(e=null),r("SelectionBox",{shape:this.currentShape,ctx:t,backgroundColor:e})},e.prototype._setShapesInProgress=function(t){switch(this.currentShapeState){case"selected":return t.setShapesInProgress([this._getSelectionShape(t.ctx),this.currentShape]);case"editing":return t.setShapesInProgress([this._getSelectionShape(t.ctx,"#fff")]);default:return t.setShapesInProgress([this.currentShape])}},e.prototype.begin=function(t,e,n){var i,o,a,h;return this.dragAction="none",this.didDrag=!1,"selected"===this.currentShapeState||"editing"===this.currentShapeState?(i=this.currentShape.getBoundingRect(n.ctx),h=this._getSelectionShape(n.ctx),a=h.getBoundingRect(),o={x:t,y:e},s(o,i)&&(this.dragAction="move"),s(o,h.getBottomRightHandleRect())&&(this.dragAction="resizeBottomRight"),s(o,h.getTopLeftHandleRect())&&(this.dragAction="resizeTopLeft"),s(o,h.getBottomLeftHandleRect())&&(this.dragAction="resizeBottomLeft"),s(o,h.getTopRightHandleRect())&&(this.dragAction="resizeTopRight"),"none"===this.dragAction&&"editing"===this.currentShapeState&&(this.dragAction="stop-editing",this._exitEditingState(n))):(this.color=n.getColor("primary"),this.currentShape=r("Text",{x:t,y:e,text:this.text,color:this.color,font:this.font,v:1}),this.dragAction="place",this.currentShapeState="selected"),"none"===this.dragAction?void this.commit(n):(this.initialShapeBoundingRect=this.currentShape.getBoundingRect(n.ctx),this.dragOffset={x:t-this.initialShapeBoundingRect.x,y:e-this.initialShapeBoundingRect.y},this._setShapesInProgress(n),n.repaintLayer("main"))},e.prototype["continue"]=function(t,e,n){var i,o,r;if("none"!==this.dragAction){switch(i=this.initialShapeBoundingRect,r=i.x+i.width,o=i.y+i.height,this.dragAction){case"place":this.currentShape.x=t,this.currentShape.y=e,this.didDrag=!0;break;case"move":this.currentShape.x=t-this.dragOffset.x,this.currentShape.y=e-this.dragOffset.y,this.didDrag=!0;break;case"resizeBottomRight":this.currentShape.setSize(t-(this.dragOffset.x-this.initialShapeBoundingRect.width)-i.x,e-(this.dragOffset.y-this.initialShapeBoundingRect.height)-i.y);break;case"resizeTopLeft":this.currentShape.setSize(r-t+this.dragOffset.x,o-e+this.dragOffset.y),this.currentShape.setPosition(t-this.dragOffset.x,e-this.dragOffset.y);break;case"resizeBottomLeft":this.currentShape.setSize(r-t+this.dragOffset.x,e-(this.dragOffset.y-this.initialShapeBoundingRect.height)-i.y),this.currentShape.setPosition(t-this.dragOffset.x,this.currentShape.y);break;case"resizeTopRight":this.currentShape.setSize(t-(this.dragOffset.x-this.initialShapeBoundingRect.width)-i.x,o-e+this.dragOffset.y),this.currentShape.setPosition(this.currentShape.x,e-this.dragOffset.y)}return this._setShapesInProgress(n),n.repaintLayer("main"),this._updateInputEl(n)}},e.prototype.end=function(t,e,n){return this.currentShape?(this.currentShape.setSize(this.currentShape.forcedWidth,0),"selected"===this.currentShapeState&&("place"===this.dragAction||"move"===this.dragAction&&!this.didDrag)&&this._enterEditingState(n),this._setShapesInProgress(n),n.repaintLayer("main"),this._updateInputEl(n)):void 0},e.prototype._enterEditingState=function(t){var e;if(this.currentShapeState="editing",this.inputEl)throw"State error";return this.inputEl=document.createElement("textarea"),this.inputEl.className="text-tool-input",this.inputEl.style.position="absolute",this.inputEl.style.transformOrigin="0px 0px",this.inputEl.style.backgroundColor="transparent",this.inputEl.style.border="none",this.inputEl.style.outline="none",this.inputEl.style.margin="0",this.inputEl.style.padding="4px",this.inputEl.style.zIndex="1000",this.inputEl.style.overflow="hidden",this.inputEl.style.resize="none",this.inputEl.value=this.currentShape.text,this.inputEl.addEventListener("mousedown",function(t){return t.stopPropagation()}),this.inputEl.addEventListener("touchstart",function(t){return t.stopPropagation()}),e=function(e){return function(n){return e.currentShape.setText(n.target.value),e.currentShape.enforceMaxBoundingRect(t),e._setShapesInProgress(t),t.repaintLayer("main"),e._updateInputEl(t),n.stopPropagation()}}(this),this.inputEl.addEventListener("keydown",function(e){return function(){return e._updateInputEl(t,!0)}}(this)),this.inputEl.addEventListener("keyup",e),this.inputEl.addEventListener("change",e),this._updateInputEl(t),t.containerEl.appendChild(this.inputEl),this.inputEl.focus(),this._setShapesInProgress(t)},e.prototype._exitEditingState=function(t){return this.currentShapeState="selected",t.containerEl.removeChild(this.inputEl),this.inputEl=null,this._setShapesInProgress(t),t.repaintLayer("main")},e.prototype._updateInputEl=function(t,e){var n,i;return null==e&&(e=!1),this.inputEl?(n=this.currentShape.getBoundingRect(t.ctx,!0),this.inputEl.style.font=this.currentShape.font,this.inputEl.style.color=this.currentShape.color,this.inputEl.style.left=""+(t.position.x/t.backingScale+n.x*t.scale-4)+"px",this.inputEl.style.top=""+(t.position.y/t.backingScale+n.y*t.scale-4)+"px",e&&!this.currentShape.forcedWidth?this.inputEl.style.width=""+(n.width+10+this.currentShape.renderer.emDashWidth)+"px":this.inputEl.style.width=""+(n.width+12)+"px",e?this.inputEl.style.height=""+(n.height+10+this.currentShape.renderer.metrics.leading)+"px":this.inputEl.style.height=""+(n.height+10)+"px",i="scale("+t.scale+")",this.inputEl.style.transform=i,this.inputEl.style.webkitTransform=i,this.inputEl.style.MozTransform=i,this.inputEl.style.msTransform=i,this.inputEl.style.OTransform=i):void 0},e.prototype.optionsStyle="font",e}(o)},{"../core/shapes":13,"./base":44}],44:[function(t,e,n){var i,o,r,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r={},r.Tool=i=function(){function t(){}return t.prototype.name=null,t.prototype.iconName=null,t.prototype.usesSimpleAPI=!0,t.prototype.begin=function(t,e,n){},t.prototype["continue"]=function(t,e,n){},t.prototype.end=function(t,e,n){},t.prototype.optionsStyle=null,t.prototype.didBecomeActive=function(t){},t.prototype.willBecomeInactive=function(t){},t}(),r.ToolWithStroke=o=function(t){function e(t){this.strokeWidth=t.opts.defaultStrokeWidth}return a(e,t),e.prototype.optionsStyle="stroke-width",e}(i),e.exports=r},{}]},{},[18])(18)});